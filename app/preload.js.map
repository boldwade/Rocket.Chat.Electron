{"version":3,"file":"preload.js","sources":["src/i18n/index.js","src/preload/spellchecking.js","src/preload/contextMenu.js","src/preload/events.js","src/preload/jitsi.js","src/preload/links.js","src/preload/notifications.js","src/preload/sidebar.js","src/preload.js"],"sourcesContent":["import path from 'path';\r\nimport fs from 'fs';\r\nimport util from 'util';\r\nimport { app, remote } from 'electron';\r\n\r\nconst eApp = app || remote.app;\r\n\r\nlet loadedLanguage = [];\r\n\r\n/**\r\n * Load singular and plural translation based on count\r\n * @param {string} phrase The key fore the translation string\r\n * @param {number} chount Count to check for singular / plural (0-1,2-n)\r\n * @returns {string} Translation in user language\r\n */\r\nfunction loadTranslation(phrase = '', count) {\r\n\tconst loadedLanguageTranslation = loadedLanguage[phrase];\r\n\tlet translation = loadedLanguageTranslation;\r\n\tif (loadedLanguageTranslation === undefined) {\r\n\t\ttranslation = phrase;\r\n\t} else if (loadedLanguageTranslation instanceof Object) {\r\n\t\ttranslation = loadedLanguageTranslation.zero;\r\n\t\tif (count === 1) {\r\n\t\t\ttranslation = loadedLanguageTranslation.one;\r\n\t\t} else if (count > 1) {\r\n\t\t\ttranslation = loadedLanguageTranslation.multi;\r\n\t\t}\r\n\t}\r\n\treturn translation;\r\n}\r\n\r\nclass I18n {\r\n\t/**\r\n     * Load users language if available, and fallback to english for any missing strings\r\n     * @constructor\r\n     */\r\n\tconstructor() {\r\n\t\tconst load = () => {\r\n\t\t\tlet dir = path.join(__dirname, '../i18n/lang');\r\n\t\t\tif (!fs.existsSync(dir)) {\r\n\t\t\t\tdir = path.join(__dirname, 'i18n/lang');\r\n\t\t\t}\r\n\t\t\tconst defaultLocale = path.join(dir, 'en.i18n.json');\r\n\t\t\tloadedLanguage = JSON.parse(fs.readFileSync(defaultLocale, 'utf8'));\r\n\t\t\tconst locale = path.join(dir, `${ eApp.getLocale() }.i18n.json`);\r\n\t\t\tif (fs.existsSync(locale)) {\r\n\t\t\t\tconst lang = JSON.parse(fs.readFileSync(locale, 'utf8'));\r\n\t\t\t\tloadedLanguage = Object.assign(loadedLanguage, lang);\r\n\t\t\t}\r\n\t\t};\r\n\r\n\t\tif (eApp.isReady()) {\r\n\t\t\tload();\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\teApp.once('ready', load);\r\n\t}\r\n\r\n\t/**\r\n     * Get translation string\r\n     * @param {string} phrase The key for the translation string\r\n     * @param {...string|number} replacements List of replacements in template strings\r\n     * @return {string} Translation in users language\r\n     */\r\n\t__(phrase, ...replacements) {\r\n\t\tconst translation = loadTranslation(phrase, 0);\r\n\t\treturn util.format(translation, ...replacements);\r\n\t}\r\n\r\n\t/**\r\n     * Get translation string\r\n     * @param {string} phrase The key for the translation string\r\n     * @param {number} count Count to check for singular / plural (0-1,2-n)\r\n     * @param {...string|number} replacements List of replacements in template strings\r\n     * @return {string} Translation in users language\r\n     */\r\n\tpluralize(phrase, count, ...replacements) {\r\n\t\tconst translation = loadTranslation(phrase, count);\r\n\t\tif (translation.includes('%s')) {\r\n\t\t\treturn util.format(translation, ...replacements);\r\n\t\t}\r\n\t\treturn translation;\r\n\t}\r\n}\r\n\r\nexport default new I18n();\r\n","import { remote, webFrame } from 'electron';\r\nimport jetpack from 'fs-jetpack';\r\nimport path from 'path';\r\nimport spellchecker from 'spellchecker';\r\nconst { app } = remote;\r\n\r\n\r\nclass SpellCheck {\r\n\tconstructor() {\r\n\t\tthis.dictionaries = [];\r\n\t\tthis.enabledDictionaries = [];\r\n\t\tthis.isMultiLanguage = false;\r\n\t\tthis.dictionariesPath = null;\r\n\t}\r\n\r\n\tasync load() {\r\n\t\tawait this.loadDictionaries();\r\n\t\tthis.setDefaultEnabledDictionaries();\r\n\t}\r\n\r\n\tasync loadDictionaries() {\r\n\t\tconst embeddedDictionaries = spellchecker.getAvailableDictionaries();\r\n\r\n\t\tconst directory = jetpack.cwd(app.getAppPath(), app.getAppPath().endsWith('app.asar') ? '..' : '.', 'dictionaries');\r\n\t\tconst installedDictionaries = (await directory.findAsync({ matching: '*.{aff,dic}' }))\r\n\t\t\t.map((fileName) => path.basename(fileName, path.extname(fileName)));\r\n\r\n\t\tthis.dictionariesPath = directory.path();\r\n\t\tthis.dictionaries = Array.from(new Set([...embeddedDictionaries, ...installedDictionaries])).sort();\r\n\t\tthis.isMultiLanguage = embeddedDictionaries.length > 0 && process.platform !== 'win32';\r\n\t}\r\n\r\n\tsetDefaultEnabledDictionaries() {\r\n\t\tconst selectedDictionaries = (() => {\r\n\t\t\ttry {\r\n\t\t\t\tconst enabledDictionaries = JSON.parse(localStorage.getItem('spellcheckerDictionaries'));\r\n\t\t\t\treturn Array.isArray(enabledDictionaries) ? enabledDictionaries.map(String) : null;\r\n\t\t\t} catch (error) {\r\n\t\t\t\tconsole.error(error);\r\n\t\t\t\treturn null;\r\n\t\t\t}\r\n\t\t})();\r\n\r\n\t\tif (selectedDictionaries) {\r\n\t\t\tthis.enable(...selectedDictionaries);\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tconst userLanguage = localStorage.getItem('userLanguage');\r\n\t\tif (userLanguage && this.enable(this.userLanguage)) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tconst navigatorLanguage = navigator.language;\r\n\t\tif (this.enable(navigatorLanguage)) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tif (this.enable('en_US')) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t}\r\n\r\n\tfilterDictionaries(...dictionaries) {\r\n\t\treturn dictionaries.map((dictionary) => {\r\n\t\t\tconst matches = /^(\\w+?)[-_](\\w+)$/.exec(dictionary);\r\n\r\n\t\t\tconst dictionaries = matches ?\r\n\t\t\t\t[`${ matches[1] }_${ matches[2] }`, `${ matches[1] }-${ matches[2] }`, matches[1]] :\r\n\t\t\t\t[dictionary];\r\n\r\n\t\t\treturn dictionaries.find((dictionary) => this.dictionaries.includes(dictionary));\r\n\t\t}).filter(Boolean);\r\n\t}\r\n\r\n\tenable(...dictionaries) {\r\n\t\tdictionaries = this.filterDictionaries(dictionaries);\r\n\r\n\t\tif (this.isMultiLanguage) {\r\n\t\t\tthis.enabledDictionaries = [\r\n\t\t\t\t...this.enabledDictionaries,\r\n\t\t\t\t...dictionaries,\r\n\t\t\t];\r\n\t\t} else {\r\n\t\t\tthis.enabledDictionaries = [dictionaries[0]];\r\n\t\t}\r\n\r\n\t\tlocalStorage.setItem('spellcheckerDictionaries', JSON.stringify(this.enabledDictionaries));\r\n\r\n\t\treturn this.enabledDictionaries.length > 0;\r\n\t}\r\n\r\n\tdisable(...dictionaries) {\r\n\t\tdictionaries = this.filterDictionaries(dictionaries);\r\n\r\n\t\tthis.enabledDictionaries = this.enabledDictionaries.filter((dictionary) => !dictionaries.includes(dictionary));\r\n\t\tlocalStorage.setItem('spellcheckerDictionaries', JSON.stringify(this.enabledDictionaries));\r\n\t}\r\n\r\n\tisCorrect(text) {\r\n\t\tif (!this.enabledDictionaries.length) {\r\n\t\t\treturn true;\r\n\t\t}\r\n\r\n\t\treturn this.enabledDictionaries.every((dictionary) => {\r\n\t\t\tspellchecker.setDictionary(dictionary, this.dictionariesPath);\r\n\t\t\treturn !spellchecker.isMisspelled(text);\r\n\t\t});\r\n\t}\r\n\r\n\tgetCorrections(text) {\r\n\t\ttext = text.trim();\r\n\r\n\t\tif (text === '' || this.isCorrect(text)) {\r\n\t\t\treturn null;\r\n\t\t}\r\n\r\n\t\treturn Array.from(new Set(\r\n\t\t\tthis.enabledDictionaries.flatMap((language) => {\r\n\t\t\t\tspellchecker.setDictionary(language, this.dictionariesPath);\r\n\t\t\t\treturn spellchecker.getCorrectionsForMisspelling(text);\r\n\t\t\t})\r\n\t\t));\r\n\t}\r\n\r\n\tasync installDictionaries(filePaths) {\r\n\t\tfor (const filePath of filePaths) {\r\n\t\t\tconst name = filePath.basename(filePath, filePath.extname(filePath));\r\n\t\t\tconst basename = filePath.basename(filePath);\r\n\t\t\tconst newPath = filePath.join(this.dictionariesPath, basename);\r\n\r\n\t\t\tawait jetpack.copyAsync(filePath, newPath);\r\n\r\n\t\t\tif (!this.dictionaries.includes(name)) {\r\n\t\t\t\tthis.dictionaries.push(name);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n}\r\n\r\nexport const spellchecking = new SpellCheck;\r\n\r\nexport default () => {\r\n\tspellchecking.load();\r\n\r\n\tconst spellCheck = (text) => spellchecking.isCorrect(text);\r\n\twebFrame.setSpellCheckProvider('', false, { spellCheck });\r\n};\r\n","import { clipboard, remote, shell } from 'electron';\r\nimport i18n from '../i18n/index';\r\nimport { spellchecking } from './spellchecking';\r\nconst { dialog, getCurrentWebContents, getCurrentWindow, Menu } = remote;\r\n\r\n\r\nconst createSpellCheckingMenuTemplate = async({\r\n\tisEditable,\r\n\tselectionText,\r\n}) => {\r\n\tif (!isEditable) {\r\n\t\treturn [];\r\n\t}\r\n\r\n\tconst corrections = spellchecking.getCorrections(selectionText);\r\n\r\n\tconst handleBrowserForLanguage = () => {\r\n\t\tconst callback = async(filePaths) => {\r\n\t\t\ttry {\r\n\t\t\t\tawait spellchecking.installDictionaries(filePaths);\r\n\t\t\t} catch (error) {\r\n\t\t\t\tdialog.showErrorBox(i18n.__('Error'), `${ i18n.__('Error copying dictionary file') }: ${ name }`);\r\n\t\t\t\tconsole.error(error);\r\n\t\t\t}\r\n\t\t};\r\n\r\n\t\tdialog.showOpenDialog(getCurrentWindow(), {\r\n\t\t\ttitle: i18n.__('Open_Language_Dictionary'),\r\n\t\t\tdefaultPath: spellchecking.dictionariesPath,\r\n\t\t\tfilters: [\r\n\t\t\t\t{ name: i18n.__('Dictionaries'), extensions: ['aff', 'dic'] },\r\n\t\t\t\t{ name: i18n.__('All files'), extensions: ['*'] },\r\n\t\t\t],\r\n\t\t\tproperties: ['openFile', 'multiSelections'],\r\n\t\t}, callback);\r\n\t};\r\n\r\n\treturn [\r\n\t\t...(corrections ? [\r\n\t\t\t...(corrections.length === 0 ? (\r\n\t\t\t\t[\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tlabel: i18n.__('No_suggestions'),\r\n\t\t\t\t\t\tenabled: false,\r\n\t\t\t\t\t},\r\n\t\t\t\t]\r\n\t\t\t) : (\r\n\t\t\t\tcorrections.slice(0, 6).map((correction) => ({\r\n\t\t\t\t\tlabel: correction,\r\n\t\t\t\t\tclick: () => getCurrentWebContents().replaceMisspelling(correction),\r\n\t\t\t\t}))\r\n\t\t\t)),\r\n\t\t\t...(corrections.length > 6 ? [\r\n\t\t\t\t{\r\n\t\t\t\t\tlabel: i18n.__('More_spelling_suggestions'),\r\n\t\t\t\t\tsubmenu: corrections.slice(6).map((correction) => ({\r\n\t\t\t\t\t\tlabel: correction,\r\n\t\t\t\t\t\tclick: () => getCurrentWebContents().replaceMisspelling(correction),\r\n\t\t\t\t\t})),\r\n\t\t\t\t},\r\n\t\t\t] : []),\r\n\t\t\t{\r\n\t\t\t\ttype: 'separator',\r\n\t\t\t},\r\n\t\t] : []),\r\n\t\t{\r\n\t\t\tlabel: i18n.__('Spelling_languages'),\r\n\t\t\tenabled: spellchecking.dictionaries.length > 0,\r\n\t\t\tsubmenu: [\r\n\t\t\t\t...spellchecking.dictionaries.map((dictionaryName) => ({\r\n\t\t\t\t\tlabel: dictionaryName,\r\n\t\t\t\t\ttype: 'checkbox',\r\n\t\t\t\t\tchecked: spellchecking.enabledDictionaries.includes(dictionaryName),\r\n\t\t\t\t\tclick: ({ checked }) => (checked ?\r\n\t\t\t\t\t\tspellchecking.enable(dictionaryName) :\r\n\t\t\t\t\t\tspellchecking.disable(dictionaryName)),\r\n\t\t\t\t})),\r\n\t\t\t\t{\r\n\t\t\t\t\ttype: 'separator',\r\n\t\t\t\t},\r\n\t\t\t\t{\r\n\t\t\t\t\tlabel: i18n.__('Browse_for_language'),\r\n\t\t\t\t\tclick: handleBrowserForLanguage,\r\n\t\t\t\t},\r\n\t\t\t],\r\n\t\t},\r\n\t\t{\r\n\t\t\ttype: 'separator',\r\n\t\t},\r\n\t];\r\n};\r\n\r\nconst createImageMenuTemplate = ({\r\n\tmediaType,\r\n\tsrcURL,\r\n}) => (\r\n\tmediaType === 'image' ?\r\n\t\t[\r\n\t\t\t{\r\n\t\t\t\tlabel: i18n.__('Save image as...'),\r\n\t\t\t\tclick: () => getCurrentWebContents().downloadURL(srcURL),\r\n\t\t\t},\r\n\t\t\t{\r\n\t\t\t\ttype: 'separator',\r\n\t\t\t},\r\n\t\t] :\r\n\t\t[]\r\n);\r\n\r\nconst createLinkMenuTemplate = ({\r\n\tlinkURL,\r\n\tlinkText,\r\n}) => (\r\n\tlinkURL ?\r\n\t\t[\r\n\t\t\t{\r\n\t\t\t\tlabel: i18n.__('Open link'),\r\n\t\t\t\tclick: () => shell.openExternal(linkURL),\r\n\t\t\t},\r\n\t\t\t{\r\n\t\t\t\tlabel: i18n.__('Copy link text'),\r\n\t\t\t\tclick: () => clipboard.write({ text: linkText, bookmark: linkText }),\r\n\t\t\t\tenabled: !!linkText,\r\n\t\t\t},\r\n\t\t\t{\r\n\t\t\t\tlabel: i18n.__('Copy link address'),\r\n\t\t\t\tclick: () => clipboard.write({ text: linkURL, bookmark: linkText }),\r\n\t\t\t},\r\n\t\t\t{\r\n\t\t\t\ttype: 'separator',\r\n\t\t\t},\r\n\t\t] :\r\n\t\t[]\r\n);\r\n\r\nconst createDefaultMenuTemplate = ({\r\n\teditFlags: {\r\n\t\tcanUndo = false,\r\n\t\tcanRedo = false,\r\n\t\tcanCut = false,\r\n\t\tcanCopy = false,\r\n\t\tcanPaste = false,\r\n\t\tcanSelectAll = false,\r\n\t} = {},\r\n} = {}) => [\r\n\t{\r\n\t\tlabel: i18n.__('&Undo'),\r\n\t\trole: 'undo',\r\n\t\taccelerator: 'CommandOrControl+Z',\r\n\t\tenabled: canUndo,\r\n\t},\r\n\t{\r\n\t\tlabel: i18n.__('&Redo'),\r\n\t\trole: 'redo',\r\n\t\taccelerator: process.platform === 'win32' ? 'Control+Y' : 'CommandOrControl+Shift+Z',\r\n\t\tenabled: canRedo,\r\n\t},\r\n\t{\r\n\t\ttype: 'separator',\r\n\t},\r\n\t{\r\n\t\tlabel: i18n.__('Cu&t'),\r\n\t\trole: 'cut',\r\n\t\taccelerator: 'CommandOrControl+X',\r\n\t\tenabled: canCut,\r\n\t},\r\n\t{\r\n\t\tlabel: i18n.__('&Copy'),\r\n\t\trole: 'copy',\r\n\t\taccelerator: 'CommandOrControl+C',\r\n\t\tenabled: canCopy,\r\n\t},\r\n\t{\r\n\t\tlabel: i18n.__('&Paste'),\r\n\t\trole: 'paste',\r\n\t\taccelerator: 'CommandOrControl+V',\r\n\t\tenabled: canPaste,\r\n\t},\r\n\t{\r\n\t\tlabel: i18n.__('Select &all'),\r\n\t\trole: 'selectall',\r\n\t\taccelerator: 'CommandOrControl+A',\r\n\t\tenabled: canSelectAll,\r\n\t},\r\n];\r\n\r\nconst createMenuTemplate = async(params) => [\r\n\t...(await createSpellCheckingMenuTemplate(params)),\r\n\t...(await createImageMenuTemplate(params)),\r\n\t...(await createLinkMenuTemplate(params)),\r\n\t...(await createDefaultMenuTemplate(params)),\r\n];\r\n\r\nexport default () => {\r\n\tgetCurrentWebContents().on('context-menu', (event, params) => {\r\n\t\tevent.preventDefault();\r\n\t\t(async() => {\r\n\t\t\tconst menu = Menu.buildFromTemplate(await createMenuTemplate(params));\r\n\t\t\tmenu.popup({ window: getCurrentWindow() });\r\n\t\t})();\r\n\t});\r\n};\r\n","import { ipcRenderer } from 'electron';\r\n\r\n\r\nconst handleTitleChange = () => {\r\n\tconst { Meteor, RocketChat, Tracker } = window;\r\n\r\n\tif (!Meteor || !RocketChat || !Tracker) {\r\n\t\treturn;\r\n\t}\r\n\r\n\tMeteor.startup(() => {\r\n\t\tTracker.autorun(() => {\r\n\t\t\tconst siteName = RocketChat.settings.get('Site_Name');\r\n\t\t\tif (siteName) {\r\n\t\t\t\tipcRenderer.sendToHost('title-changed', siteName);\r\n\t\t\t}\r\n\t\t});\r\n\t});\r\n};\r\n\r\n\r\nconst handleUserPresenceChange = () => {\r\n\tconst { Meteor, UserPresence } = window;\r\n\r\n\tif (!Meteor || !UserPresence) {\r\n\t\treturn;\r\n\t}\r\n\r\n\tconst idleDetectionInterval = 10000;\r\n\tsetInterval(() => {\r\n\t\ttry {\r\n\t\t\tconst idleTime = ipcRenderer.sendSync('getSystemIdleTime');\r\n\t\t\tif (idleTime < idleDetectionInterval) {\r\n\t\t\t\tUserPresence.setOnline();\r\n\t\t\t}\r\n\t\t} catch (e) {\r\n\t\t\tconsole.error(`Error getting system idle time: ${ e }`);\r\n\t\t}\r\n\t}, idleDetectionInterval);\r\n};\r\n\r\n\r\nexport default () => {\r\n\tdocument.addEventListener('dragover', (event) => event.preventDefault());\r\n\tdocument.addEventListener('drop', (event) => event.preventDefault());\r\n\r\n\tconst eventsListened = ['unread-changed', 'get-sourceId', 'user-status-manually-set'];\r\n\r\n\tfor (const eventName of eventsListened) {\r\n\t\twindow.addEventListener(eventName, (event) => ipcRenderer.sendToHost(eventName, event.detail));\r\n\t}\r\n\r\n\twindow.addEventListener('load', () => {\r\n\t\thandleTitleChange();\r\n\t\thandleUserPresenceChange();\r\n\t});\r\n};\r\n","import { desktopCapturer } from 'electron';\r\nimport path from 'path';\r\nimport url from 'url';\r\n\r\n\r\nconst JitsiMeetElectron = {\r\n\tobtainDesktopStreams(callback, errorCallback, options = {}) {\r\n\t\tdesktopCapturer.getSources(options, (error, sources) => {\r\n\t\t\tif (error) {\r\n\t\t\t\terrorCallback(error);\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tcallback(sources);\r\n\t\t});\r\n\t},\r\n};\r\n\r\n\r\nconst wrapWindowOpen = (defaultWindowOpen) => (href, frameName, features) => {\r\n\tconst { RocketChat } = window;\r\n\r\n\tif (RocketChat && url.parse(href).host === RocketChat.settings.get('Jitsi_Domain')) {\r\n\t\tfeatures = [\r\n\t\t\tfeatures,\r\n\t\t\t'nodeIntegration=true',\r\n\t\t\t`preload=${ path.join(__dirname, './preload.js') }`,\r\n\t\t].filter((x) => Boolean(x)).join(',');\r\n\t}\r\n\r\n\treturn defaultWindowOpen(href, frameName, features);\r\n};\r\n\r\n\r\nconst pollJitsiIframe = () => {\r\n\tconst jitsiIframe = document.querySelector('iframe[id^=jitsiConference]');\r\n\tif (!jitsiIframe) {\r\n\t\treturn;\r\n\t}\r\n\r\n\tjitsiIframe.contentWindow.JitsiMeetElectron = JitsiMeetElectron;\r\n};\r\n\r\n\r\nexport default () => {\r\n\twindow.JitsiMeetElectron = JitsiMeetElectron;\r\n\r\n\twindow.open = wrapWindowOpen(window.open);\r\n\r\n\twindow.addEventListener('load', () => {\r\n\t\tsetInterval(pollJitsiIframe, 1000);\r\n\t});\r\n};\r\n","import { shell } from 'electron';\r\n\r\n\r\nconst handleAnchorClick = (event) => {\r\n\tconst a = event.target.closest('a');\r\n\r\n\tif (!a) {\r\n\t\treturn;\r\n\t}\r\n\r\n\tconst href = a.getAttribute('href');\r\n\tconst download = a.hasAttribute('download');\r\n\r\n\tconst isFileUpload = /^\\/file-upload\\//.test(href) && !download;\r\n\tif (isFileUpload) {\r\n\t\tconst clone = a.cloneNode();\r\n\t\tclone.setAttribute('download', 'download');\r\n\t\tclone.click();\r\n\t\tevent.preventDefault();\r\n\t\treturn;\r\n\t}\r\n\r\n\tconst isLocalFilePath = /^file:\\/\\/.+/.test(href);\r\n\tif (isLocalFilePath) {\r\n\t\tconst filePath = href.slice(6);\r\n\t\tshell.showItemInFolder(filePath);\r\n\t\tevent.preventDefault();\r\n\t\treturn;\r\n\t}\r\n\r\n\tconst { Meteor } = window;\r\n\tconst isInsideDomain = Meteor && RegExp(`^${ Meteor.absoluteUrl() }`).test(href);\r\n\tconst isRelative = !/^([a-z]+:)?\\/\\//.test(href);\r\n\tif (isInsideDomain || isRelative) {\r\n\t\treturn;\r\n\t}\r\n\r\n\tshell.openExternal(href);\r\n\tevent.preventDefault();\r\n};\r\n\r\n\r\nexport default () => {\r\n\twindow.addEventListener('load', () => {\r\n\t\tdocument.addEventListener('click', handleAnchorClick, true);\r\n\t});\r\n};\r\n","import { ipcRenderer, nativeImage } from 'electron';\r\nimport { EventEmitter } from 'events';\r\nimport jetpack from 'fs-jetpack';\r\nimport tmp from 'tmp';\r\n\r\n\r\nconst instances = new Map();\r\n\r\nclass Notification extends EventEmitter {\r\n\tstatic requestPermission() {\r\n\t\treturn;\r\n\t}\r\n\r\n\tstatic get permission() {\r\n\t\treturn 'granted';\r\n\t}\r\n\r\n\tconstructor(title, options) {\r\n\t\tsuper();\r\n\r\n\t\tthis.create({ title, ...options });\r\n\t}\r\n\r\n\tasync create({ icon, ...options }) {\r\n\t\tif (icon) {\r\n\t\t\tNotification.cachedIcons = Notification.cachedIcons || {};\r\n\r\n\t\t\tif (!Notification.cachedIcons[icon]) {\r\n\t\t\t\tNotification.cachedIcons[icon] = await new Promise((resolve, reject) =>\r\n\t\t\t\t\ttmp.file((err, path) => (err ? reject(err) : resolve(path))));\r\n\t\t\t\tconst buffer = nativeImage.createFromDataURL(icon).toPNG();\r\n\t\t\t\tawait jetpack.writeAsync(Notification.cachedIcons[icon], buffer);\r\n\t\t\t}\r\n\t\t\ticon = Notification.cachedIcons[icon];\r\n\t\t}\r\n\r\n\t\tthis.id = ipcRenderer.sendSync('request-notification', { icon, ...options });\r\n\t\tinstances.set(this.id, this);\r\n\t}\r\n\r\n\tclose() {\r\n\t\tipcRenderer.send('close-notification', this.id);\r\n\t}\r\n}\r\n\r\nconst handleNotificationShown = (event, id) => {\r\n\tconst notification = instances.get(id);\r\n\tif (!notification) {\r\n\t\treturn;\r\n\t}\r\n\r\n\ttypeof notification.onshow === 'function' && notification.onshow.call(notification);\r\n\tnotification.emit('show');\r\n};\r\n\r\nconst handleNotificationClicked = (event, id) => {\r\n\tconst notification = instances.get(id);\r\n\tif (!notification) {\r\n\t\treturn;\r\n\t}\r\n\r\n\tipcRenderer.send('focus');\r\n\tipcRenderer.sendToHost('focus');\r\n\r\n\ttypeof notification.onclick === 'function' && notification.onclick.call(notification);\r\n\tnotification.emit('click');\r\n};\r\n\r\nconst handleNotificationClosed = (event, id) => {\r\n\tconst notification = instances.get(id);\r\n\tif (!notification) {\r\n\t\treturn;\r\n\t}\r\n\r\n\ttypeof notification.onclose === 'function' && notification.onclose.call(notification);\r\n\tnotification.emit('close');\r\n};\r\n\r\n\r\nexport default () => {\r\n\twindow.Notification = Notification;\r\n\tipcRenderer.on('notification-shown', handleNotificationShown);\r\n\tipcRenderer.on('notification-clicked', handleNotificationClicked);\r\n\tipcRenderer.on('notification-closed', handleNotificationClosed);\r\n};\r\n","import { ipcRenderer } from 'electron';\r\n\r\n\r\nconst requestSidebarColor = function pollSidebarColor() {\r\n\tconst sidebar = document.querySelector('.sidebar');\r\n\tif (sidebar) {\r\n\t\tconst { color, background } = window.getComputedStyle(sidebar);\r\n\t\tconst sidebarItem = sidebar.querySelector('.sidebar-item');\r\n\t\tconst itemColor = sidebarItem && window.getComputedStyle(sidebarItem).color;\r\n\t\tipcRenderer.sendToHost('sidebar-background', { color: itemColor || color, background });\r\n\t\treturn;\r\n\t}\r\n\r\n\tconst fullpage = document.querySelector('.full-page');\r\n\tif (fullpage) {\r\n\t\tconst { color, background } = window.getComputedStyle(fullpage);\r\n\t\tipcRenderer.sendToHost('sidebar-background', { color, background });\r\n\t\treturn;\r\n\t}\r\n\r\n\trequestAnimationFrame(pollSidebarColor);\r\n};\r\n\r\nexport default () => {\r\n\tipcRenderer.on('request-sidebar-color', requestSidebarColor);\r\n};\r\n","import { ipcRenderer } from 'electron';\r\nimport setupContextMenuPreload from './preload/contextMenu';\r\nimport setupEventsPreload from './preload/events';\r\nimport setupJitsiPreload from './preload/jitsi';\r\nimport setupLinksPreload from './preload/links';\r\nimport setupNotificationsPreload from './preload/notifications';\r\nimport setupSidebarPreload from './preload/sidebar';\r\nimport setupSpellcheckingPreload from './preload/spellchecking';\r\n\r\n\r\nsetupContextMenuPreload();\r\nsetupEventsPreload();\r\nsetupJitsiPreload();\r\nsetupLinksPreload();\r\nsetupNotificationsPreload();\r\nsetupSidebarPreload();\r\nsetupSpellcheckingPreload();\r\n\r\nwindow.reloadServer = () => ipcRenderer.sendToHost('reload-server');\r\nwindow.i18n = require('./i18n');\r\n"],"names":["app","remote","webFrame","shell","clipboard","ipcRenderer","desktopCapturer","EventEmitter","path","nativeImage"],"mappings":";;;;;;;;;;;;;;;;AAKA,MAAM,IAAI,GAAGA,YAAG,IAAIC,eAAM,CAAC,GAAG,CAAC;;AAE/B,IAAI,cAAc,GAAG,EAAE,CAAC;;;;;;;;AAQxB,SAAS,eAAe,CAAC,MAAM,GAAG,EAAE,EAAE,KAAK,EAAE;CAC5C,MAAM,yBAAyB,GAAG,cAAc,CAAC,MAAM,CAAC,CAAC;CACzD,IAAI,WAAW,GAAG,yBAAyB,CAAC;CAC5C,IAAI,yBAAyB,KAAK,SAAS,EAAE;EAC5C,WAAW,GAAG,MAAM,CAAC;EACrB,MAAM,IAAI,yBAAyB,YAAY,MAAM,EAAE;EACvD,WAAW,GAAG,yBAAyB,CAAC,IAAI,CAAC;EAC7C,IAAI,KAAK,KAAK,CAAC,EAAE;GAChB,WAAW,GAAG,yBAAyB,CAAC,GAAG,CAAC;GAC5C,MAAM,IAAI,KAAK,GAAG,CAAC,EAAE;GACrB,WAAW,GAAG,yBAAyB,CAAC,KAAK,CAAC;GAC9C;EACD;CACD,OAAO,WAAW,CAAC;CACnB;;AAED,MAAM,IAAI,CAAC;;;;;CAKV,WAAW,GAAG;EACb,MAAM,IAAI,GAAG,MAAM;GAClB,IAAI,GAAG,GAAG,IAAI,CAAC,IAAI,CAAC,SAAS,EAAE,cAAc,CAAC,CAAC;GAC/C,IAAI,CAAC,EAAE,CAAC,UAAU,CAAC,GAAG,CAAC,EAAE;IACxB,GAAG,GAAG,IAAI,CAAC,IAAI,CAAC,SAAS,EAAE,WAAW,CAAC,CAAC;IACxC;GACD,MAAM,aAAa,GAAG,IAAI,CAAC,IAAI,CAAC,GAAG,EAAE,cAAc,CAAC,CAAC;GACrD,cAAc,GAAG,IAAI,CAAC,KAAK,CAAC,EAAE,CAAC,YAAY,CAAC,aAAa,EAAE,MAAM,CAAC,CAAC,CAAC;GACpE,MAAM,MAAM,GAAG,IAAI,CAAC,IAAI,CAAC,GAAG,EAAE,CAAC,GAAG,IAAI,CAAC,SAAS,EAAE,EAAE,UAAU,CAAC,CAAC,CAAC;GACjE,IAAI,EAAE,CAAC,UAAU,CAAC,MAAM,CAAC,EAAE;IAC1B,MAAM,IAAI,GAAG,IAAI,CAAC,KAAK,CAAC,EAAE,CAAC,YAAY,CAAC,MAAM,EAAE,MAAM,CAAC,CAAC,CAAC;IACzD,cAAc,GAAG,MAAM,CAAC,MAAM,CAAC,cAAc,EAAE,IAAI,CAAC,CAAC;IACrD;GACD,CAAC;;EAEF,IAAI,IAAI,CAAC,OAAO,EAAE,EAAE;GACnB,IAAI,EAAE,CAAC;GACP,OAAO;GACP;;EAED,IAAI,CAAC,IAAI,CAAC,OAAO,EAAE,IAAI,CAAC,CAAC;EACzB;;;;;;;;CAQD,EAAE,CAAC,MAAM,EAAE,GAAG,YAAY,EAAE;EAC3B,MAAM,WAAW,GAAG,eAAe,CAAC,MAAM,EAAE,CAAC,CAAC,CAAC;EAC/C,OAAO,IAAI,CAAC,MAAM,CAAC,WAAW,EAAE,GAAG,YAAY,CAAC,CAAC;EACjD;;;;;;;;;CASD,SAAS,CAAC,MAAM,EAAE,KAAK,EAAE,GAAG,YAAY,EAAE;EACzC,MAAM,WAAW,GAAG,eAAe,CAAC,MAAM,EAAE,KAAK,CAAC,CAAC;EACnD,IAAI,WAAW,CAAC,QAAQ,CAAC,IAAI,CAAC,EAAE;GAC/B,OAAO,IAAI,CAAC,MAAM,CAAC,WAAW,EAAE,GAAG,YAAY,CAAC,CAAC;GACjD;EACD,OAAO,WAAW,CAAC;EACnB;CACD;;AAED,WAAe,IAAI,IAAI,EAAE,CAAC;;AClF1B,MAAM,EAAE,GAAG,EAAE,GAAGA,eAAM,CAAC;;;AAGvB,MAAM,UAAU,CAAC;CAChB,WAAW,GAAG;EACb,IAAI,CAAC,YAAY,GAAG,EAAE,CAAC;EACvB,IAAI,CAAC,mBAAmB,GAAG,EAAE,CAAC;EAC9B,IAAI,CAAC,eAAe,GAAG,KAAK,CAAC;EAC7B,IAAI,CAAC,gBAAgB,GAAG,IAAI,CAAC;EAC7B;;CAED,MAAM,IAAI,GAAG;EACZ,MAAM,IAAI,CAAC,gBAAgB,EAAE,CAAC;EAC9B,IAAI,CAAC,6BAA6B,EAAE,CAAC;EACrC;;CAED,MAAM,gBAAgB,GAAG;EACxB,MAAM,oBAAoB,GAAG,YAAY,CAAC,wBAAwB,EAAE,CAAC;;EAErE,MAAM,SAAS,GAAG,OAAO,CAAC,GAAG,CAAC,GAAG,CAAC,UAAU,EAAE,EAAE,GAAG,CAAC,UAAU,EAAE,CAAC,QAAQ,CAAC,UAAU,CAAC,GAAG,IAAI,GAAG,GAAG,EAAE,cAAc,CAAC,CAAC;EACpH,MAAM,qBAAqB,GAAG,CAAC,MAAM,SAAS,CAAC,SAAS,CAAC,EAAE,QAAQ,EAAE,aAAa,EAAE,CAAC;IACnF,GAAG,CAAC,CAAC,QAAQ,KAAK,IAAI,CAAC,QAAQ,CAAC,QAAQ,EAAE,IAAI,CAAC,OAAO,CAAC,QAAQ,CAAC,CAAC,CAAC,CAAC;;EAErE,IAAI,CAAC,gBAAgB,GAAG,SAAS,CAAC,IAAI,EAAE,CAAC;EACzC,IAAI,CAAC,YAAY,GAAG,KAAK,CAAC,IAAI,CAAC,IAAI,GAAG,CAAC,CAAC,GAAG,oBAAoB,EAAE,GAAG,qBAAqB,CAAC,CAAC,CAAC,CAAC,IAAI,EAAE,CAAC;EACpG,IAAI,CAAC,eAAe,GAAG,oBAAoB,CAAC,MAAM,GAAG,CAAC,IAAI,OAAO,CAAC,QAAQ,KAAK,OAAO,CAAC;EACvF;;CAED,6BAA6B,GAAG;EAC/B,MAAM,oBAAoB,GAAG,CAAC,MAAM;GACnC,IAAI;IACH,MAAM,mBAAmB,GAAG,IAAI,CAAC,KAAK,CAAC,YAAY,CAAC,OAAO,CAAC,0BAA0B,CAAC,CAAC,CAAC;IACzF,OAAO,KAAK,CAAC,OAAO,CAAC,mBAAmB,CAAC,GAAG,mBAAmB,CAAC,GAAG,CAAC,MAAM,CAAC,GAAG,IAAI,CAAC;IACnF,CAAC,OAAO,KAAK,EAAE;IACf,OAAO,CAAC,KAAK,CAAC,KAAK,CAAC,CAAC;IACrB,OAAO,IAAI,CAAC;IACZ;GACD,GAAG,CAAC;;EAEL,IAAI,oBAAoB,EAAE;GACzB,IAAI,CAAC,MAAM,CAAC,GAAG,oBAAoB,CAAC,CAAC;GACrC,OAAO;GACP;;EAED,MAAM,YAAY,GAAG,YAAY,CAAC,OAAO,CAAC,cAAc,CAAC,CAAC;EAC1D,IAAI,YAAY,IAAI,IAAI,CAAC,MAAM,CAAC,IAAI,CAAC,YAAY,CAAC,EAAE;GACnD,OAAO;GACP;;EAED,MAAM,iBAAiB,GAAG,SAAS,CAAC,QAAQ,CAAC;EAC7C,IAAI,IAAI,CAAC,MAAM,CAAC,iBAAiB,CAAC,EAAE;GACnC,OAAO;GACP;;EAED,IAAI,IAAI,CAAC,MAAM,CAAC,OAAO,CAAC,EAAE;GACzB,OAAO;GACP;EACD;;CAED,kBAAkB,CAAC,GAAG,YAAY,EAAE;EACnC,OAAO,YAAY,CAAC,GAAG,CAAC,CAAC,UAAU,KAAK;GACvC,MAAM,OAAO,GAAG,mBAAmB,CAAC,IAAI,CAAC,UAAU,CAAC,CAAC;;GAErD,MAAM,YAAY,GAAG,OAAO;IAC3B,CAAC,CAAC,GAAG,OAAO,CAAC,CAAC,CAAC,EAAE,CAAC,GAAG,OAAO,CAAC,CAAC,CAAC,EAAE,CAAC,EAAE,CAAC,GAAG,OAAO,CAAC,CAAC,CAAC,EAAE,CAAC,GAAG,OAAO,CAAC,CAAC,CAAC,EAAE,CAAC,EAAE,OAAO,CAAC,CAAC,CAAC,CAAC;IAClF,CAAC,UAAU,CAAC,CAAC;;GAEd,OAAO,YAAY,CAAC,IAAI,CAAC,CAAC,UAAU,KAAK,IAAI,CAAC,YAAY,CAAC,QAAQ,CAAC,UAAU,CAAC,CAAC,CAAC;GACjF,CAAC,CAAC,MAAM,CAAC,OAAO,CAAC,CAAC;EACnB;;CAED,MAAM,CAAC,GAAG,YAAY,EAAE;EACvB,YAAY,GAAG,IAAI,CAAC,kBAAkB,CAAC,YAAY,CAAC,CAAC;;EAErD,IAAI,IAAI,CAAC,eAAe,EAAE;GACzB,IAAI,CAAC,mBAAmB,GAAG;IAC1B,GAAG,IAAI,CAAC,mBAAmB;IAC3B,GAAG,YAAY;IACf,CAAC;GACF,MAAM;GACN,IAAI,CAAC,mBAAmB,GAAG,CAAC,YAAY,CAAC,CAAC,CAAC,CAAC,CAAC;GAC7C;;EAED,YAAY,CAAC,OAAO,CAAC,0BAA0B,EAAE,IAAI,CAAC,SAAS,CAAC,IAAI,CAAC,mBAAmB,CAAC,CAAC,CAAC;;EAE3F,OAAO,IAAI,CAAC,mBAAmB,CAAC,MAAM,GAAG,CAAC,CAAC;EAC3C;;CAED,OAAO,CAAC,GAAG,YAAY,EAAE;EACxB,YAAY,GAAG,IAAI,CAAC,kBAAkB,CAAC,YAAY,CAAC,CAAC;;EAErD,IAAI,CAAC,mBAAmB,GAAG,IAAI,CAAC,mBAAmB,CAAC,MAAM,CAAC,CAAC,UAAU,KAAK,CAAC,YAAY,CAAC,QAAQ,CAAC,UAAU,CAAC,CAAC,CAAC;EAC/G,YAAY,CAAC,OAAO,CAAC,0BAA0B,EAAE,IAAI,CAAC,SAAS,CAAC,IAAI,CAAC,mBAAmB,CAAC,CAAC,CAAC;EAC3F;;CAED,SAAS,CAAC,IAAI,EAAE;EACf,IAAI,CAAC,IAAI,CAAC,mBAAmB,CAAC,MAAM,EAAE;GACrC,OAAO,IAAI,CAAC;GACZ;;EAED,OAAO,IAAI,CAAC,mBAAmB,CAAC,KAAK,CAAC,CAAC,UAAU,KAAK;GACrD,YAAY,CAAC,aAAa,CAAC,UAAU,EAAE,IAAI,CAAC,gBAAgB,CAAC,CAAC;GAC9D,OAAO,CAAC,YAAY,CAAC,YAAY,CAAC,IAAI,CAAC,CAAC;GACxC,CAAC,CAAC;EACH;;CAED,cAAc,CAAC,IAAI,EAAE;EACpB,IAAI,GAAG,IAAI,CAAC,IAAI,EAAE,CAAC;;EAEnB,IAAI,IAAI,KAAK,EAAE,IAAI,IAAI,CAAC,SAAS,CAAC,IAAI,CAAC,EAAE;GACxC,OAAO,IAAI,CAAC;GACZ;;EAED,OAAO,KAAK,CAAC,IAAI,CAAC,IAAI,GAAG;GACxB,IAAI,CAAC,mBAAmB,CAAC,OAAO,CAAC,CAAC,QAAQ,KAAK;IAC9C,YAAY,CAAC,aAAa,CAAC,QAAQ,EAAE,IAAI,CAAC,gBAAgB,CAAC,CAAC;IAC5D,OAAO,YAAY,CAAC,4BAA4B,CAAC,IAAI,CAAC,CAAC;IACvD,CAAC;GACF,CAAC,CAAC;EACH;;CAED,MAAM,mBAAmB,CAAC,SAAS,EAAE;EACpC,KAAK,MAAM,QAAQ,IAAI,SAAS,EAAE;GACjC,MAAM,IAAI,GAAG,QAAQ,CAAC,QAAQ,CAAC,QAAQ,EAAE,QAAQ,CAAC,OAAO,CAAC,QAAQ,CAAC,CAAC,CAAC;GACrE,MAAM,QAAQ,GAAG,QAAQ,CAAC,QAAQ,CAAC,QAAQ,CAAC,CAAC;GAC7C,MAAM,OAAO,GAAG,QAAQ,CAAC,IAAI,CAAC,IAAI,CAAC,gBAAgB,EAAE,QAAQ,CAAC,CAAC;;GAE/D,MAAM,OAAO,CAAC,SAAS,CAAC,QAAQ,EAAE,OAAO,CAAC,CAAC;;GAE3C,IAAI,CAAC,IAAI,CAAC,YAAY,CAAC,QAAQ,CAAC,IAAI,CAAC,EAAE;IACtC,IAAI,CAAC,YAAY,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;IAC7B;GACD;EACD;CACD;;AAED,AAAO,MAAM,aAAa,GAAG,IAAI,UAAU,CAAC;;AAE5C,gCAAe,MAAM;CACpB,aAAa,CAAC,IAAI,EAAE,CAAC;;CAErB,MAAM,UAAU,GAAG,CAAC,IAAI,KAAK,aAAa,CAAC,SAAS,CAAC,IAAI,CAAC,CAAC;CAC3DC,iBAAQ,CAAC,qBAAqB,CAAC,EAAE,EAAE,KAAK,EAAE,EAAE,UAAU,EAAE,CAAC,CAAC;CAC1D,CAAC;;AChJF,MAAM,EAAE,MAAM,EAAE,qBAAqB,EAAE,gBAAgB,EAAE,IAAI,EAAE,GAAGD,eAAM,CAAC;;;AAGzE,MAAM,+BAA+B,GAAG,MAAM;CAC7C,UAAU;CACV,aAAa;CACb,KAAK;CACL,IAAI,CAAC,UAAU,EAAE;EAChB,OAAO,EAAE,CAAC;EACV;;CAED,MAAM,WAAW,GAAG,aAAa,CAAC,cAAc,CAAC,aAAa,CAAC,CAAC;;CAEhE,MAAM,wBAAwB,GAAG,MAAM;EACtC,MAAM,QAAQ,GAAG,MAAM,SAAS,KAAK;GACpC,IAAI;IACH,MAAM,aAAa,CAAC,mBAAmB,CAAC,SAAS,CAAC,CAAC;IACnD,CAAC,OAAO,KAAK,EAAE;IACf,MAAM,CAAC,YAAY,CAAC,IAAI,CAAC,EAAE,CAAC,OAAO,CAAC,EAAE,CAAC,GAAG,IAAI,CAAC,EAAE,CAAC,+BAA+B,CAAC,EAAE,EAAE,GAAG,IAAI,EAAE,CAAC,CAAC,CAAC;IAClG,OAAO,CAAC,KAAK,CAAC,KAAK,CAAC,CAAC;IACrB;GACD,CAAC;;EAEF,MAAM,CAAC,cAAc,CAAC,gBAAgB,EAAE,EAAE;GACzC,KAAK,EAAE,IAAI,CAAC,EAAE,CAAC,0BAA0B,CAAC;GAC1C,WAAW,EAAE,aAAa,CAAC,gBAAgB;GAC3C,OAAO,EAAE;IACR,EAAE,IAAI,EAAE,IAAI,CAAC,EAAE,CAAC,cAAc,CAAC,EAAE,UAAU,EAAE,CAAC,KAAK,EAAE,KAAK,CAAC,EAAE;IAC7D,EAAE,IAAI,EAAE,IAAI,CAAC,EAAE,CAAC,WAAW,CAAC,EAAE,UAAU,EAAE,CAAC,GAAG,CAAC,EAAE;IACjD;GACD,UAAU,EAAE,CAAC,UAAU,EAAE,iBAAiB,CAAC;GAC3C,EAAE,QAAQ,CAAC,CAAC;EACb,CAAC;;CAEF,OAAO;EACN,IAAI,WAAW,GAAG;GACjB,IAAI,WAAW,CAAC,MAAM,KAAK,CAAC;IAC3B;KACC;MACC,KAAK,EAAE,IAAI,CAAC,EAAE,CAAC,gBAAgB,CAAC;MAChC,OAAO,EAAE,KAAK;MACd;KACD;;IAED,WAAW,CAAC,KAAK,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,GAAG,CAAC,CAAC,UAAU,MAAM;KAC5C,KAAK,EAAE,UAAU;KACjB,KAAK,EAAE,MAAM,qBAAqB,EAAE,CAAC,kBAAkB,CAAC,UAAU,CAAC;KACnE,CAAC,CAAC;IACH,CAAC;GACF,IAAI,WAAW,CAAC,MAAM,GAAG,CAAC,GAAG;IAC5B;KACC,KAAK,EAAE,IAAI,CAAC,EAAE,CAAC,2BAA2B,CAAC;KAC3C,OAAO,EAAE,WAAW,CAAC,KAAK,CAAC,CAAC,CAAC,CAAC,GAAG,CAAC,CAAC,UAAU,MAAM;MAClD,KAAK,EAAE,UAAU;MACjB,KAAK,EAAE,MAAM,qBAAqB,EAAE,CAAC,kBAAkB,CAAC,UAAU,CAAC;MACnE,CAAC,CAAC;KACH;IACD,GAAG,EAAE,CAAC;GACP;IACC,IAAI,EAAE,WAAW;IACjB;GACD,GAAG,EAAE,CAAC;EACP;GACC,KAAK,EAAE,IAAI,CAAC,EAAE,CAAC,oBAAoB,CAAC;GACpC,OAAO,EAAE,aAAa,CAAC,YAAY,CAAC,MAAM,GAAG,CAAC;GAC9C,OAAO,EAAE;IACR,GAAG,aAAa,CAAC,YAAY,CAAC,GAAG,CAAC,CAAC,cAAc,MAAM;KACtD,KAAK,EAAE,cAAc;KACrB,IAAI,EAAE,UAAU;KAChB,OAAO,EAAE,aAAa,CAAC,mBAAmB,CAAC,QAAQ,CAAC,cAAc,CAAC;KACnE,KAAK,EAAE,CAAC,EAAE,OAAO,EAAE,MAAM,OAAO;MAC/B,aAAa,CAAC,MAAM,CAAC,cAAc,CAAC;MACpC,aAAa,CAAC,OAAO,CAAC,cAAc,CAAC,CAAC;KACvC,CAAC,CAAC;IACH;KACC,IAAI,EAAE,WAAW;KACjB;IACD;KACC,KAAK,EAAE,IAAI,CAAC,EAAE,CAAC,qBAAqB,CAAC;KACrC,KAAK,EAAE,wBAAwB;KAC/B;IACD;GACD;EACD;GACC,IAAI,EAAE,WAAW;GACjB;EACD,CAAC;CACF,CAAC;;AAEF,MAAM,uBAAuB,GAAG,CAAC;CAChC,SAAS;CACT,MAAM;CACN;CACA,SAAS,KAAK,OAAO;EACpB;GACC;IACC,KAAK,EAAE,IAAI,CAAC,EAAE,CAAC,kBAAkB,CAAC;IAClC,KAAK,EAAE,MAAM,qBAAqB,EAAE,CAAC,WAAW,CAAC,MAAM,CAAC;IACxD;GACD;IACC,IAAI,EAAE,WAAW;IACjB;GACD;EACD,EAAE;CACH,CAAC;;AAEF,MAAM,sBAAsB,GAAG,CAAC;CAC/B,OAAO;CACP,QAAQ;CACR;CACA,OAAO;EACN;GACC;IACC,KAAK,EAAE,IAAI,CAAC,EAAE,CAAC,WAAW,CAAC;IAC3B,KAAK,EAAE,MAAME,cAAK,CAAC,YAAY,CAAC,OAAO,CAAC;IACxC;GACD;IACC,KAAK,EAAE,IAAI,CAAC,EAAE,CAAC,gBAAgB,CAAC;IAChC,KAAK,EAAE,MAAMC,kBAAS,CAAC,KAAK,CAAC,EAAE,IAAI,EAAE,QAAQ,EAAE,QAAQ,EAAE,QAAQ,EAAE,CAAC;IACpE,OAAO,EAAE,CAAC,CAAC,QAAQ;IACnB;GACD;IACC,KAAK,EAAE,IAAI,CAAC,EAAE,CAAC,mBAAmB,CAAC;IACnC,KAAK,EAAE,MAAMA,kBAAS,CAAC,KAAK,CAAC,EAAE,IAAI,EAAE,OAAO,EAAE,QAAQ,EAAE,QAAQ,EAAE,CAAC;IACnE;GACD;IACC,IAAI,EAAE,WAAW;IACjB;GACD;EACD,EAAE;CACH,CAAC;;AAEF,MAAM,yBAAyB,GAAG,CAAC;CAClC,SAAS,EAAE;EACV,OAAO,GAAG,KAAK;EACf,OAAO,GAAG,KAAK;EACf,MAAM,GAAG,KAAK;EACd,OAAO,GAAG,KAAK;EACf,QAAQ,GAAG,KAAK;EAChB,YAAY,GAAG,KAAK;EACpB,GAAG,EAAE;CACN,GAAG,EAAE,KAAK;CACV;EACC,KAAK,EAAE,IAAI,CAAC,EAAE,CAAC,OAAO,CAAC;EACvB,IAAI,EAAE,MAAM;EACZ,WAAW,EAAE,oBAAoB;EACjC,OAAO,EAAE,OAAO;EAChB;CACD;EACC,KAAK,EAAE,IAAI,CAAC,EAAE,CAAC,OAAO,CAAC;EACvB,IAAI,EAAE,MAAM;EACZ,WAAW,EAAE,OAAO,CAAC,QAAQ,KAAK,OAAO,GAAG,WAAW,GAAG,0BAA0B;EACpF,OAAO,EAAE,OAAO;EAChB;CACD;EACC,IAAI,EAAE,WAAW;EACjB;CACD;EACC,KAAK,EAAE,IAAI,CAAC,EAAE,CAAC,MAAM,CAAC;EACtB,IAAI,EAAE,KAAK;EACX,WAAW,EAAE,oBAAoB;EACjC,OAAO,EAAE,MAAM;EACf;CACD;EACC,KAAK,EAAE,IAAI,CAAC,EAAE,CAAC,OAAO,CAAC;EACvB,IAAI,EAAE,MAAM;EACZ,WAAW,EAAE,oBAAoB;EACjC,OAAO,EAAE,OAAO;EAChB;CACD;EACC,KAAK,EAAE,IAAI,CAAC,EAAE,CAAC,QAAQ,CAAC;EACxB,IAAI,EAAE,OAAO;EACb,WAAW,EAAE,oBAAoB;EACjC,OAAO,EAAE,QAAQ;EACjB;CACD;EACC,KAAK,EAAE,IAAI,CAAC,EAAE,CAAC,aAAa,CAAC;EAC7B,IAAI,EAAE,WAAW;EACjB,WAAW,EAAE,oBAAoB;EACjC,OAAO,EAAE,YAAY;EACrB;CACD,CAAC;;AAEF,MAAM,kBAAkB,GAAG,MAAM,MAAM,KAAK;CAC3C,IAAI,MAAM,+BAA+B,CAAC,MAAM,CAAC,CAAC;CAClD,IAAI,MAAM,uBAAuB,CAAC,MAAM,CAAC,CAAC;CAC1C,IAAI,MAAM,sBAAsB,CAAC,MAAM,CAAC,CAAC;CACzC,IAAI,MAAM,yBAAyB,CAAC,MAAM,CAAC,CAAC;CAC5C,CAAC;;AAEF,8BAAe,MAAM;CACpB,qBAAqB,EAAE,CAAC,EAAE,CAAC,cAAc,EAAE,CAAC,KAAK,EAAE,MAAM,KAAK;EAC7D,KAAK,CAAC,cAAc,EAAE,CAAC;EACvB,CAAC,WAAW;GACX,MAAM,IAAI,GAAG,IAAI,CAAC,iBAAiB,CAAC,MAAM,kBAAkB,CAAC,MAAM,CAAC,CAAC,CAAC;GACtE,IAAI,CAAC,KAAK,CAAC,EAAE,MAAM,EAAE,gBAAgB,EAAE,EAAE,CAAC,CAAC;GAC3C,GAAG,CAAC;EACL,CAAC,CAAC;CACH,CAAC;;ACtMF,MAAM,iBAAiB,GAAG,MAAM;CAC/B,MAAM,EAAE,MAAM,EAAE,UAAU,EAAE,OAAO,EAAE,GAAG,MAAM,CAAC;;CAE/C,IAAI,CAAC,MAAM,IAAI,CAAC,UAAU,IAAI,CAAC,OAAO,EAAE;EACvC,OAAO;EACP;;CAED,MAAM,CAAC,OAAO,CAAC,MAAM;EACpB,OAAO,CAAC,OAAO,CAAC,MAAM;GACrB,MAAM,QAAQ,GAAG,UAAU,CAAC,QAAQ,CAAC,GAAG,CAAC,WAAW,CAAC,CAAC;GACtD,IAAI,QAAQ,EAAE;IACbC,oBAAW,CAAC,UAAU,CAAC,eAAe,EAAE,QAAQ,CAAC,CAAC;IAClD;GACD,CAAC,CAAC;EACH,CAAC,CAAC;CACH,CAAC;;;AAGF,MAAM,wBAAwB,GAAG,MAAM;CACtC,MAAM,EAAE,MAAM,EAAE,YAAY,EAAE,GAAG,MAAM,CAAC;;CAExC,IAAI,CAAC,MAAM,IAAI,CAAC,YAAY,EAAE;EAC7B,OAAO;EACP;;CAED,MAAM,qBAAqB,GAAG,KAAK,CAAC;CACpC,WAAW,CAAC,MAAM;EACjB,IAAI;GACH,MAAM,QAAQ,GAAGA,oBAAW,CAAC,QAAQ,CAAC,mBAAmB,CAAC,CAAC;GAC3D,IAAI,QAAQ,GAAG,qBAAqB,EAAE;IACrC,YAAY,CAAC,SAAS,EAAE,CAAC;IACzB;GACD,CAAC,OAAO,CAAC,EAAE;GACX,OAAO,CAAC,KAAK,CAAC,CAAC,gCAAgC,GAAG,CAAC,EAAE,CAAC,CAAC,CAAC;GACxD;EACD,EAAE,qBAAqB,CAAC,CAAC;CAC1B,CAAC;;;AAGF,yBAAe,MAAM;CACpB,QAAQ,CAAC,gBAAgB,CAAC,UAAU,EAAE,CAAC,KAAK,KAAK,KAAK,CAAC,cAAc,EAAE,CAAC,CAAC;CACzE,QAAQ,CAAC,gBAAgB,CAAC,MAAM,EAAE,CAAC,KAAK,KAAK,KAAK,CAAC,cAAc,EAAE,CAAC,CAAC;;CAErE,MAAM,cAAc,GAAG,CAAC,gBAAgB,EAAE,cAAc,EAAE,0BAA0B,CAAC,CAAC;;CAEtF,KAAK,MAAM,SAAS,IAAI,cAAc,EAAE;EACvC,MAAM,CAAC,gBAAgB,CAAC,SAAS,EAAE,CAAC,KAAK,KAAKA,oBAAW,CAAC,UAAU,CAAC,SAAS,EAAE,KAAK,CAAC,MAAM,CAAC,CAAC,CAAC;EAC/F;;CAED,MAAM,CAAC,gBAAgB,CAAC,MAAM,EAAE,MAAM;EACrC,iBAAiB,EAAE,CAAC;EACpB,wBAAwB,EAAE,CAAC;EAC3B,CAAC,CAAC;CACH,CAAC;;ACnDF,MAAM,iBAAiB,GAAG;CACzB,oBAAoB,CAAC,QAAQ,EAAE,aAAa,EAAE,OAAO,GAAG,EAAE,EAAE;EAC3DC,wBAAe,CAAC,UAAU,CAAC,OAAO,EAAE,CAAC,KAAK,EAAE,OAAO,KAAK;GACvD,IAAI,KAAK,EAAE;IACV,aAAa,CAAC,KAAK,CAAC,CAAC;IACrB,OAAO;IACP;;GAED,QAAQ,CAAC,OAAO,CAAC,CAAC;GAClB,CAAC,CAAC;EACH;CACD,CAAC;;;AAGF,MAAM,cAAc,GAAG,CAAC,iBAAiB,KAAK,CAAC,IAAI,EAAE,SAAS,EAAE,QAAQ,KAAK;CAC5E,MAAM,EAAE,UAAU,EAAE,GAAG,MAAM,CAAC;;CAE9B,IAAI,UAAU,IAAI,GAAG,CAAC,KAAK,CAAC,IAAI,CAAC,CAAC,IAAI,KAAK,UAAU,CAAC,QAAQ,CAAC,GAAG,CAAC,cAAc,CAAC,EAAE;EACnF,QAAQ,GAAG;GACV,QAAQ;GACR,sBAAsB;GACtB,CAAC,QAAQ,GAAG,IAAI,CAAC,IAAI,CAAC,SAAS,EAAE,cAAc,CAAC,EAAE,CAAC;GACnD,CAAC,MAAM,CAAC,CAAC,CAAC,KAAK,OAAO,CAAC,CAAC,CAAC,CAAC,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC;EACtC;;CAED,OAAO,iBAAiB,CAAC,IAAI,EAAE,SAAS,EAAE,QAAQ,CAAC,CAAC;CACpD,CAAC;;;AAGF,MAAM,eAAe,GAAG,MAAM;CAC7B,MAAM,WAAW,GAAG,QAAQ,CAAC,aAAa,CAAC,6BAA6B,CAAC,CAAC;CAC1E,IAAI,CAAC,WAAW,EAAE;EACjB,OAAO;EACP;;CAED,WAAW,CAAC,aAAa,CAAC,iBAAiB,GAAG,iBAAiB,CAAC;CAChE,CAAC;;;AAGF,wBAAe,MAAM;CACpB,MAAM,CAAC,iBAAiB,GAAG,iBAAiB,CAAC;;CAE7C,MAAM,CAAC,IAAI,GAAG,cAAc,CAAC,MAAM,CAAC,IAAI,CAAC,CAAC;;CAE1C,MAAM,CAAC,gBAAgB,CAAC,MAAM,EAAE,MAAM;EACrC,WAAW,CAAC,eAAe,EAAE,IAAI,CAAC,CAAC;EACnC,CAAC,CAAC;CACH,CAAC;;ACjDF,MAAM,iBAAiB,GAAG,CAAC,KAAK,KAAK;CACpC,MAAM,CAAC,GAAG,KAAK,CAAC,MAAM,CAAC,OAAO,CAAC,GAAG,CAAC,CAAC;;CAEpC,IAAI,CAAC,CAAC,EAAE;EACP,OAAO;EACP;;CAED,MAAM,IAAI,GAAG,CAAC,CAAC,YAAY,CAAC,MAAM,CAAC,CAAC;CACpC,MAAM,QAAQ,GAAG,CAAC,CAAC,YAAY,CAAC,UAAU,CAAC,CAAC;;CAE5C,MAAM,YAAY,GAAG,kBAAkB,CAAC,IAAI,CAAC,IAAI,CAAC,IAAI,CAAC,QAAQ,CAAC;CAChE,IAAI,YAAY,EAAE;EACjB,MAAM,KAAK,GAAG,CAAC,CAAC,SAAS,EAAE,CAAC;EAC5B,KAAK,CAAC,YAAY,CAAC,UAAU,EAAE,UAAU,CAAC,CAAC;EAC3C,KAAK,CAAC,KAAK,EAAE,CAAC;EACd,KAAK,CAAC,cAAc,EAAE,CAAC;EACvB,OAAO;EACP;;CAED,MAAM,eAAe,GAAG,cAAc,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;CAClD,IAAI,eAAe,EAAE;EACpB,MAAM,QAAQ,GAAG,IAAI,CAAC,KAAK,CAAC,CAAC,CAAC,CAAC;EAC/BH,cAAK,CAAC,gBAAgB,CAAC,QAAQ,CAAC,CAAC;EACjC,KAAK,CAAC,cAAc,EAAE,CAAC;EACvB,OAAO;EACP;;CAED,MAAM,EAAE,MAAM,EAAE,GAAG,MAAM,CAAC;CAC1B,MAAM,cAAc,GAAG,MAAM,IAAI,MAAM,CAAC,CAAC,CAAC,GAAG,MAAM,CAAC,WAAW,EAAE,EAAE,CAAC,CAAC,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;CACjF,MAAM,UAAU,GAAG,CAAC,iBAAiB,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;CACjD,IAAI,cAAc,IAAI,UAAU,EAAE;EACjC,OAAO;EACP;;CAEDA,cAAK,CAAC,YAAY,CAAC,IAAI,CAAC,CAAC;CACzB,KAAK,CAAC,cAAc,EAAE,CAAC;CACvB,CAAC;;;AAGF,wBAAe,MAAM;CACpB,MAAM,CAAC,gBAAgB,CAAC,MAAM,EAAE,MAAM;EACrC,QAAQ,CAAC,gBAAgB,CAAC,OAAO,EAAE,iBAAiB,EAAE,IAAI,CAAC,CAAC;EAC5D,CAAC,CAAC;CACH,CAAC;;ACxCF,MAAM,SAAS,GAAG,IAAI,GAAG,EAAE,CAAC;;AAE5B,MAAM,YAAY,SAASI,mBAAY,CAAC;CACvC,OAAO,iBAAiB,GAAG;EAC1B,OAAO;EACP;;CAED,WAAW,UAAU,GAAG;EACvB,OAAO,SAAS,CAAC;EACjB;;CAED,WAAW,CAAC,KAAK,EAAE,OAAO,EAAE;EAC3B,KAAK,EAAE,CAAC;;EAER,IAAI,CAAC,MAAM,CAAC,EAAE,KAAK,EAAE,GAAG,OAAO,EAAE,CAAC,CAAC;EACnC;;CAED,MAAM,MAAM,CAAC,EAAE,IAAI,EAAE,GAAG,OAAO,EAAE,EAAE;EAClC,IAAI,IAAI,EAAE;GACT,YAAY,CAAC,WAAW,GAAG,YAAY,CAAC,WAAW,IAAI,EAAE,CAAC;;GAE1D,IAAI,CAAC,YAAY,CAAC,WAAW,CAAC,IAAI,CAAC,EAAE;IACpC,YAAY,CAAC,WAAW,CAAC,IAAI,CAAC,GAAG,MAAM,IAAI,OAAO,CAAC,CAAC,OAAO,EAAE,MAAM;KAClE,GAAG,CAAC,IAAI,CAAC,CAAC,GAAG,EAAEC,OAAI,MAAM,GAAG,GAAG,MAAM,CAAC,GAAG,CAAC,GAAG,OAAO,CAACA,OAAI,CAAC,CAAC,CAAC,CAAC,CAAC;IAC/D,MAAM,MAAM,GAAGC,oBAAW,CAAC,iBAAiB,CAAC,IAAI,CAAC,CAAC,KAAK,EAAE,CAAC;IAC3D,MAAM,OAAO,CAAC,UAAU,CAAC,YAAY,CAAC,WAAW,CAAC,IAAI,CAAC,EAAE,MAAM,CAAC,CAAC;IACjE;GACD,IAAI,GAAG,YAAY,CAAC,WAAW,CAAC,IAAI,CAAC,CAAC;GACtC;;EAED,IAAI,CAAC,EAAE,GAAGJ,oBAAW,CAAC,QAAQ,CAAC,sBAAsB,EAAE,EAAE,IAAI,EAAE,GAAG,OAAO,EAAE,CAAC,CAAC;EAC7E,SAAS,CAAC,GAAG,CAAC,IAAI,CAAC,EAAE,EAAE,IAAI,CAAC,CAAC;EAC7B;;CAED,KAAK,GAAG;EACPA,oBAAW,CAAC,IAAI,CAAC,oBAAoB,EAAE,IAAI,CAAC,EAAE,CAAC,CAAC;EAChD;CACD;;AAED,MAAM,uBAAuB,GAAG,CAAC,KAAK,EAAE,EAAE,KAAK;CAC9C,MAAM,YAAY,GAAG,SAAS,CAAC,GAAG,CAAC,EAAE,CAAC,CAAC;CACvC,IAAI,CAAC,YAAY,EAAE;EAClB,OAAO;EACP;;CAED,OAAO,YAAY,CAAC,MAAM,KAAK,UAAU,IAAI,YAAY,CAAC,MAAM,CAAC,IAAI,CAAC,YAAY,CAAC,CAAC;CACpF,YAAY,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC;CAC1B,CAAC;;AAEF,MAAM,yBAAyB,GAAG,CAAC,KAAK,EAAE,EAAE,KAAK;CAChD,MAAM,YAAY,GAAG,SAAS,CAAC,GAAG,CAAC,EAAE,CAAC,CAAC;CACvC,IAAI,CAAC,YAAY,EAAE;EAClB,OAAO;EACP;;CAEDA,oBAAW,CAAC,IAAI,CAAC,OAAO,CAAC,CAAC;CAC1BA,oBAAW,CAAC,UAAU,CAAC,OAAO,CAAC,CAAC;;CAEhC,OAAO,YAAY,CAAC,OAAO,KAAK,UAAU,IAAI,YAAY,CAAC,OAAO,CAAC,IAAI,CAAC,YAAY,CAAC,CAAC;CACtF,YAAY,CAAC,IAAI,CAAC,OAAO,CAAC,CAAC;CAC3B,CAAC;;AAEF,MAAM,wBAAwB,GAAG,CAAC,KAAK,EAAE,EAAE,KAAK;CAC/C,MAAM,YAAY,GAAG,SAAS,CAAC,GAAG,CAAC,EAAE,CAAC,CAAC;CACvC,IAAI,CAAC,YAAY,EAAE;EAClB,OAAO;EACP;;CAED,OAAO,YAAY,CAAC,OAAO,KAAK,UAAU,IAAI,YAAY,CAAC,OAAO,CAAC,IAAI,CAAC,YAAY,CAAC,CAAC;CACtF,YAAY,CAAC,IAAI,CAAC,OAAO,CAAC,CAAC;CAC3B,CAAC;;;AAGF,gCAAe,MAAM;CACpB,MAAM,CAAC,YAAY,GAAG,YAAY,CAAC;CACnCA,oBAAW,CAAC,EAAE,CAAC,oBAAoB,EAAE,uBAAuB,CAAC,CAAC;CAC9DA,oBAAW,CAAC,EAAE,CAAC,sBAAsB,EAAE,yBAAyB,CAAC,CAAC;CAClEA,oBAAW,CAAC,EAAE,CAAC,qBAAqB,EAAE,wBAAwB,CAAC,CAAC;CAChE,CAAC;;ACjFF,MAAM,mBAAmB,GAAG,SAAS,gBAAgB,GAAG;CACvD,MAAM,OAAO,GAAG,QAAQ,CAAC,aAAa,CAAC,UAAU,CAAC,CAAC;CACnD,IAAI,OAAO,EAAE;EACZ,MAAM,EAAE,KAAK,EAAE,UAAU,EAAE,GAAG,MAAM,CAAC,gBAAgB,CAAC,OAAO,CAAC,CAAC;EAC/D,MAAM,WAAW,GAAG,OAAO,CAAC,aAAa,CAAC,eAAe,CAAC,CAAC;EAC3D,MAAM,SAAS,GAAG,WAAW,IAAI,MAAM,CAAC,gBAAgB,CAAC,WAAW,CAAC,CAAC,KAAK,CAAC;EAC5EA,oBAAW,CAAC,UAAU,CAAC,oBAAoB,EAAE,EAAE,KAAK,EAAE,SAAS,IAAI,KAAK,EAAE,UAAU,EAAE,CAAC,CAAC;EACxF,OAAO;EACP;;CAED,MAAM,QAAQ,GAAG,QAAQ,CAAC,aAAa,CAAC,YAAY,CAAC,CAAC;CACtD,IAAI,QAAQ,EAAE;EACb,MAAM,EAAE,KAAK,EAAE,UAAU,EAAE,GAAG,MAAM,CAAC,gBAAgB,CAAC,QAAQ,CAAC,CAAC;EAChEA,oBAAW,CAAC,UAAU,CAAC,oBAAoB,EAAE,EAAE,KAAK,EAAE,UAAU,EAAE,CAAC,CAAC;EACpE,OAAO;EACP;;CAED,qBAAqB,CAAC,gBAAgB,CAAC,CAAC;CACxC,CAAC;;AAEF,0BAAe,MAAM;CACpBA,oBAAW,CAAC,EAAE,CAAC,uBAAuB,EAAE,mBAAmB,CAAC,CAAC;CAC7D,CAAC;;ACfF,uBAAuB,EAAE,CAAC;AAC1B,kBAAkB,EAAE,CAAC;AACrB,iBAAiB,EAAE,CAAC;AACpB,iBAAiB,EAAE,CAAC;AACpB,yBAAyB,EAAE,CAAC;AAC5B,mBAAmB,EAAE,CAAC;AACtB,yBAAyB,EAAE,CAAC;;AAE5B,MAAM,CAAC,YAAY,GAAG,MAAMA,oBAAW,CAAC,UAAU,CAAC,eAAe,CAAC,CAAC;AACpE,MAAM,CAAC,IAAI,GAAG,OAAO,CAAC,QAAQ,CAAC,CAAC;;;;"}