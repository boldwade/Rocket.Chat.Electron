{"version":3,"file":"app.js","sources":["src/i18n/index.js","src/scripts/servers.js","src/scripts/webview.js","src/scripts/sidebar.js","src/scripts/touchBar.js","src/scripts/events.js","src/scripts/start.js","src/app.js"],"sourcesContent":["import path from 'path';\r\nimport fs from 'fs';\r\nimport util from 'util';\r\nimport { app, remote } from 'electron';\r\n\r\nconst eApp = app || remote.app;\r\n\r\nlet loadedLanguage = [];\r\n\r\n/**\r\n * Load singular and plural translation based on count\r\n * @param {string} phrase The key fore the translation string\r\n * @param {number} chount Count to check for singular / plural (0-1,2-n)\r\n * @returns {string} Translation in user language\r\n */\r\nfunction loadTranslation(phrase = '', count) {\r\n\tconst loadedLanguageTranslation = loadedLanguage[phrase];\r\n\tlet translation = loadedLanguageTranslation;\r\n\tif (loadedLanguageTranslation === undefined) {\r\n\t\ttranslation = phrase;\r\n\t} else if (loadedLanguageTranslation instanceof Object) {\r\n\t\ttranslation = loadedLanguageTranslation.zero;\r\n\t\tif (count === 1) {\r\n\t\t\ttranslation = loadedLanguageTranslation.one;\r\n\t\t} else if (count > 1) {\r\n\t\t\ttranslation = loadedLanguageTranslation.multi;\r\n\t\t}\r\n\t}\r\n\treturn translation;\r\n}\r\n\r\nclass I18n {\r\n\t/**\r\n     * Load users language if available, and fallback to english for any missing strings\r\n     * @constructor\r\n     */\r\n\tconstructor() {\r\n\t\tconst load = () => {\r\n\t\t\tlet dir = path.join(__dirname, '../i18n/lang');\r\n\t\t\tif (!fs.existsSync(dir)) {\r\n\t\t\t\tdir = path.join(__dirname, 'i18n/lang');\r\n\t\t\t}\r\n\t\t\tconst defaultLocale = path.join(dir, 'en.i18n.json');\r\n\t\t\tloadedLanguage = JSON.parse(fs.readFileSync(defaultLocale, 'utf8'));\r\n\t\t\tconst locale = path.join(dir, `${ eApp.getLocale() }.i18n.json`);\r\n\t\t\tif (fs.existsSync(locale)) {\r\n\t\t\t\tconst lang = JSON.parse(fs.readFileSync(locale, 'utf8'));\r\n\t\t\t\tloadedLanguage = Object.assign(loadedLanguage, lang);\r\n\t\t\t}\r\n\t\t};\r\n\r\n\t\tif (eApp.isReady()) {\r\n\t\t\tload();\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\teApp.once('ready', load);\r\n\t}\r\n\r\n\t/**\r\n     * Get translation string\r\n     * @param {string} phrase The key for the translation string\r\n     * @param {...string|number} replacements List of replacements in template strings\r\n     * @return {string} Translation in users language\r\n     */\r\n\t__(phrase, ...replacements) {\r\n\t\tconst translation = loadTranslation(phrase, 0);\r\n\t\treturn util.format(translation, ...replacements);\r\n\t}\r\n\r\n\t/**\r\n     * Get translation string\r\n     * @param {string} phrase The key for the translation string\r\n     * @param {number} count Count to check for singular / plural (0-1,2-n)\r\n     * @param {...string|number} replacements List of replacements in template strings\r\n     * @return {string} Translation in users language\r\n     */\r\n\tpluralize(phrase, count, ...replacements) {\r\n\t\tconst translation = loadTranslation(phrase, count);\r\n\t\tif (translation.includes('%s')) {\r\n\t\t\treturn util.format(translation, ...replacements);\r\n\t\t}\r\n\t\treturn translation;\r\n\t}\r\n}\r\n\r\nexport default new I18n();\r\n","import jetpack from 'fs-jetpack';\r\nimport { EventEmitter } from 'events';\r\nimport { remote, ipcRenderer } from 'electron';\r\nimport i18n from '../i18n/index.js';\r\nconst { remoteServers } = remote.require('./background');\r\n\r\nclass Servers extends EventEmitter {\r\n\tconstructor() {\r\n\t\tsuper();\r\n\t\tthis.load();\r\n\t\tconst processProtocol = this.getProtocolUrlFromProcess(remote.process.argv);\r\n\t\tif (processProtocol) {\r\n\t\t\tthis.showHostConfirmation(processProtocol);\r\n\t\t}\r\n\t\tipcRenderer.on('add-host', (e, host) => {\r\n\t\t\tif (this.hostExists(host)) {\r\n\t\t\t\tthis.setActive(host);\r\n\t\t\t} else {\r\n\t\t\t\tthis.showHostConfirmation(host);\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\r\n\tget hosts() {\r\n\t\treturn this._hosts;\r\n\t}\r\n\r\n\tset hosts(hosts) {\r\n\t\tthis._hosts = hosts;\r\n\t\tthis.save();\r\n\t\treturn true;\r\n\t}\r\n\r\n\tget hostsKey() {\r\n\t\treturn 'rocket.chat.hosts';\r\n\t}\r\n\r\n\tget activeKey() {\r\n\t\treturn 'rocket.chat.currentHost';\r\n\t}\r\n\r\n\tload() {\r\n\t\tlet hosts = localStorage.getItem(this.hostsKey);\r\n\r\n\t\ttry {\r\n\t\t\thosts = JSON.parse(hosts);\r\n\t\t} catch (e) {\r\n\t\t\tif (typeof hosts === 'string' && hosts.match(/^https?:\\/\\//)) {\r\n\t\t\t\thosts = {};\r\n\t\t\t\thosts[hosts] = {\r\n\t\t\t\t\ttitle: hosts,\r\n\t\t\t\t\turl: hosts,\r\n\t\t\t\t};\r\n\t\t\t}\r\n\r\n\t\t\tlocalStorage.setItem(this.hostsKey, JSON.stringify(hosts));\r\n\t\t}\r\n\r\n\t\tif (hosts === null) {\r\n\t\t\thosts = {};\r\n\t\t}\r\n\r\n\t\tif (Array.isArray(hosts)) {\r\n\t\t\tconst oldHosts = hosts;\r\n\t\t\thosts = {};\r\n\t\t\toldHosts.forEach(function(item) {\r\n\t\t\t\titem = item.replace(/\\/$/, '');\r\n\t\t\t\thosts[item] = {\r\n\t\t\t\t\ttitle: item,\r\n\t\t\t\t\turl: item,\r\n\t\t\t\t};\r\n\t\t\t});\r\n\t\t\tlocalStorage.setItem(this.hostsKey, JSON.stringify(hosts));\r\n\t\t}\r\n\r\n\t\t// Load server info from server config file\r\n\t\tif (Object.keys(hosts).length === 0) {\r\n\t\t\tconst { app } = remote;\r\n\t\t\tconst userDir = jetpack.cwd(app.getPath('userData'));\r\n\t\t\tconst appDir = jetpack.cwd(jetpack.path(app.getAppPath(), app.getAppPath().endsWith('.asar') ? '..' : '.'));\r\n\t\t\tconst path = (userDir.find({ matching: 'servers.json', recursive: false })[0] && userDir.path('servers.json')) ||\r\n\t\t\t\t(appDir.find({ matching: 'servers.json', recursive: false })[0] && appDir.path('servers.json'));\r\n\r\n\t\t\tif (path) {\r\n\t\t\t\ttry {\r\n\t\t\t\t\tconst result = jetpack.read(path, 'json');\r\n\t\t\t\t\tif (result) {\r\n\t\t\t\t\t\thosts = {};\r\n\t\t\t\t\t\tObject.keys(result).forEach((title) => {\r\n\t\t\t\t\t\t\tconst url = result[title];\r\n\t\t\t\t\t\t\thosts[url] = { title, url };\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t\tlocalStorage.setItem(this.hostsKey, JSON.stringify(hosts));\r\n\t\t\t\t\t\t// Assume user doesn't want sidebar if they only have one server\r\n\t\t\t\t\t\tif (Object.keys(hosts).length === 1) {\r\n\t\t\t\t\t\t\tlocalStorage.setItem('sidebar-closed', 'true');\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t} catch (e) {\r\n\t\t\t\t\tconsole.error('Server file invalid');\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tthis._hosts = hosts;\r\n\t\tremoteServers.loadServers(this._hosts);\r\n\t\tthis.emit('loaded');\r\n\t}\r\n\r\n\tsave() {\r\n\t\tlocalStorage.setItem(this.hostsKey, JSON.stringify(this._hosts));\r\n\t\tthis.emit('saved');\r\n\t}\r\n\r\n\tget(hostUrl) {\r\n\t\treturn this.hosts[hostUrl];\r\n\t}\r\n\r\n\tforEach(cb) {\r\n\t\tfor (const host in this.hosts) {\r\n\t\t\tif (this.hosts.hasOwnProperty(host)) {\r\n\t\t\t\tcb(this.hosts[host]);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tasync validateHost(hostUrl, timeout = 5000) {\r\n\t\tconst response = await Promise.race([\r\n\t\t\tfetch(`${ hostUrl }/api/info`),\r\n\t\t\tnew Promise((resolve, reject) => setTimeout(() => reject('timeout'), timeout)),\r\n\t\t]);\r\n\r\n\t\tif (!response.ok) {\r\n\t\t\tthrow 'invalid';\r\n\t\t}\r\n\t}\r\n\r\n\thostExists(hostUrl) {\r\n\t\tconst { hosts } = this;\r\n\r\n\t\treturn !!hosts[hostUrl];\r\n\t}\r\n\r\n\taddHost(hostUrl) {\r\n\t\tconst { hosts } = this;\r\n\r\n\t\tconst match = hostUrl.match(/^(https?:\\/\\/)([^:]+):([^@]+)@(.+)$/);\r\n\t\tlet username;\r\n\t\tlet password;\r\n\t\tlet authUrl;\r\n\t\tif (match) {\r\n\t\t\tauthUrl = hostUrl;\r\n\t\t\thostUrl = match[1] + match[4];\r\n\t\t\tusername = match[2];\r\n\t\t\tpassword = match[3];\r\n\t\t}\r\n\r\n\t\tif (this.hostExists(hostUrl) === true) {\r\n\t\t\tthis.setActive(hostUrl);\r\n\t\t\treturn false;\r\n\t\t}\r\n\r\n\t\thosts[hostUrl] = {\r\n\t\t\ttitle: hostUrl,\r\n\t\t\turl: hostUrl,\r\n\t\t\tauthUrl,\r\n\t\t\tusername,\r\n\t\t\tpassword,\r\n\t\t};\r\n\t\tthis.hosts = hosts;\r\n\r\n\t\tremoteServers.loadServers(this.hosts);\r\n\r\n\t\tthis.emit('host-added', hostUrl);\r\n\r\n\t\treturn hostUrl;\r\n\t}\r\n\r\n\tremoveHost(hostUrl) {\r\n\t\tconst { hosts } = this;\r\n\t\tif (hosts[hostUrl]) {\r\n\t\t\tdelete hosts[hostUrl];\r\n\t\t\tthis.hosts = hosts;\r\n\r\n\t\t\tremoteServers.loadServers(this.hosts);\r\n\r\n\t\t\tif (this.active === hostUrl) {\r\n\t\t\t\tthis.clearActive();\r\n\t\t\t}\r\n\t\t\tthis.emit('host-removed', hostUrl);\r\n\t\t}\r\n\t}\r\n\r\n\tget active() {\r\n\t\treturn localStorage.getItem(this.activeKey);\r\n\t}\r\n\r\n\tsetActive(hostUrl) {\r\n\t\tlet url;\r\n\t\tif (this.hostExists(hostUrl)) {\r\n\t\t\turl = hostUrl;\r\n\t\t} else if (Object.keys(this._hosts).length > 0) {\r\n\t\t\turl = Object.keys(this._hosts)[0];\r\n\t\t}\r\n\r\n\t\tif (url) {\r\n\t\t\tlocalStorage.setItem(this.activeKey, hostUrl);\r\n\t\t\tthis.emit('active-setted', url);\r\n\t\t\treturn true;\r\n\t\t}\r\n\t\tthis.emit('loaded');\r\n\t\treturn false;\r\n\t}\r\n\r\n\trestoreActive() {\r\n\t\tthis.setActive(this.active);\r\n\t}\r\n\r\n\tclearActive() {\r\n\t\tlocalStorage.removeItem(this.activeKey);\r\n\t\tthis.emit('active-cleared');\r\n\t\treturn true;\r\n\t}\r\n\r\n\tsetHostTitle(hostUrl, title) {\r\n\t\tif (title === 'Rocket.Chat' && /https?:\\/\\/open\\.rocket\\.chat/.test(hostUrl) === false) {\r\n\t\t\ttitle += ` - ${ hostUrl }`;\r\n\t\t}\r\n\t\tconst { hosts } = this;\r\n\t\thosts[hostUrl].title = title;\r\n\t\tthis.hosts = hosts;\r\n\t\tthis.emit('title-setted', hostUrl, title);\r\n\t}\r\n\tgetProtocolUrlFromProcess(args) {\r\n\t\tlet site = null;\r\n\t\tif (args.length > 1) {\r\n\t\t\tconst protocolURI = args.find((arg) => arg.startsWith('rocketchat://'));\r\n\t\t\tif (protocolURI) {\r\n\t\t\t\tsite = protocolURI.split(/\\/|\\?/)[2];\r\n\t\t\t\tif (site) {\r\n\t\t\t\t\tlet scheme = 'https://';\r\n\t\t\t\t\tif (protocolURI.includes('insecure=true')) {\r\n\t\t\t\t\t\tscheme = 'http://';\r\n\t\t\t\t\t}\r\n\t\t\t\t\tsite = scheme + site;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn site;\r\n\t}\r\n\tshowHostConfirmation(host) {\r\n\t\treturn remote.dialog.showMessageBox({\r\n\t\t\ttype: 'question',\r\n\t\t\tbuttons: [i18n.__('Add'), i18n.__('Cancel')],\r\n\t\t\tdefaultId: 0,\r\n\t\t\ttitle: i18n.__('Add_Server'),\r\n\t\t\tmessage: i18n.__('Add_host_to_servers', host),\r\n\t\t}, (response) => {\r\n\t\t\tif (response === 0) {\r\n\t\t\t\tthis.validateHost(host)\r\n\t\t\t\t\t.then(() => this.addHost(host))\r\n\t\t\t\t\t.then(() => this.setActive(host))\r\n\t\t\t\t\t.catch(() => remote.dialog.showErrorBox(i18n.__('Invalid_Host'), i18n.__('Host_not_validated', host)));\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\r\n\tresetAppData() {\r\n\t\tconst response = remote.dialog.showMessageBox({\r\n\t\t\ttype: 'question',\r\n\t\t\tbuttons: ['Yes', 'Cancel'],\r\n\t\t\tdefaultId: 1,\r\n\t\t\ttitle: i18n.__('Reset app data'),\r\n\t\t\tmessage: i18n.__('This will sign you out from all your teams and reset the app back to its ' +\r\n\t\t\t\t'original settings. This cannot be undone.'),\r\n\t\t});\r\n\r\n\t\tif (response !== 0) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tipcRenderer.send('reset-app-data');\r\n\t}\r\n\r\n}\r\n\r\nexport default new Servers();\r\n","import { EventEmitter } from 'events';\r\nimport servers from './servers';\r\nimport sidebar from './sidebar';\r\nimport { ipcRenderer } from 'electron';\r\n\r\nclass WebView extends EventEmitter {\r\n\tconstructor() {\r\n\t\tsuper();\r\n\r\n\t\tthis.webviewParentElement = document.body;\r\n\r\n\t\tservers.forEach((host) => {\r\n\t\t\tthis.add(host);\r\n\t\t});\r\n\r\n\t\tservers.on('host-added', (hostUrl) => {\r\n\t\t\tthis.add(servers.get(hostUrl));\r\n\t\t});\r\n\r\n\t\tservers.on('host-removed', (hostUrl) => {\r\n\t\t\tthis.remove(hostUrl);\r\n\t\t});\r\n\r\n\t\tservers.on('active-setted', (hostUrl) => {\r\n\t\t\tthis.setActive(hostUrl);\r\n\t\t});\r\n\r\n\t\tservers.on('active-cleared', (hostUrl) => {\r\n\t\t\tthis.deactiveAll(hostUrl);\r\n\t\t});\r\n\r\n\t\tservers.once('loaded', () => {\r\n\t\t\tthis.loaded();\r\n\t\t});\r\n\r\n\t\tipcRenderer.on('screenshare-result', (e, id) => {\r\n\t\t\tconst webviewObj = this.getActive();\r\n\t\t\twebviewObj.executeJavaScript(`\r\n\t\t\t\twindow.parent.postMessage({ sourceId: '${ id }' }, '*');\r\n\t\t\t`);\r\n\t\t});\r\n\t}\r\n\r\n\tloaded() {\r\n\t\tdocument.querySelector('.app-page').classList.remove('app-page--loading');\r\n\t}\r\n\r\n\tloading() {\r\n\t\tdocument.querySelector('.app-page').classList.add('app-page--loading');\r\n\t}\r\n\r\n\tadd(host) {\r\n\t\tlet webviewObj = this.getByUrl(host.url);\r\n\t\tif (webviewObj) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\twebviewObj = document.createElement('webview');\r\n\t\twebviewObj.setAttribute('server', host.url);\r\n\t\twebviewObj.setAttribute('preload', '../preload.js');\r\n\t\twebviewObj.setAttribute('allowpopups', 'on');\r\n\t\twebviewObj.setAttribute('disablewebsecurity', 'on');\r\n\r\n\t\twebviewObj.addEventListener('did-navigate-in-page', (lastPath) => {\r\n\t\t\tif ((lastPath.url).includes(host.url)) {\r\n\t\t\t\tthis.saveLastPath(host.url, lastPath.url);\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\twebviewObj.addEventListener('console-message', (e) => {\r\n\t\t\tconsole.log('webview:', e.message);\r\n\t\t});\r\n\r\n\t\twebviewObj.addEventListener('ipc-message', (event) => {\r\n\t\t\tthis.emit(`ipc-message-${ event.channel }`, host.url, event.args);\r\n\r\n\t\t\tswitch (event.channel) {\r\n\t\t\t\tcase 'title-changed':\r\n\t\t\t\t\tservers.setHostTitle(host.url, event.args[0]);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 'unread-changed':\r\n\t\t\t\t\tsidebar.setBadge(host.url, event.args[0]);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 'focus':\r\n\t\t\t\t\tservers.setActive(host.url);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 'get-sourceId':\r\n\t\t\t\t\tipcRenderer.send('open-screenshare-dialog');\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 'reload-server':\r\n\t\t\t\t\tconst active = this.getActive();\r\n\t\t\t\t\tconst server = active.getAttribute('server');\r\n\t\t\t\t\tthis.loading();\r\n\t\t\t\t\tactive.loadURL(server);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 'sidebar-background':\r\n\t\t\t\t\tsidebar.changeSidebarColor(event.args[0]);\r\n\t\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\twebviewObj.addEventListener('dom-ready', () => {\r\n\t\t\twebviewObj.classList.add('ready');\r\n\t\t\tthis.emit('dom-ready', host.url);\r\n\t\t});\r\n\r\n\t\twebviewObj.addEventListener('did-fail-load', (e) => {\r\n\t\t\tif (e.isMainFrame) {\r\n\t\t\t\twebviewObj.loadURL(`file://${ __dirname }/loading-error.html`);\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\twebviewObj.addEventListener('did-get-response-details', (e) => {\r\n\t\t\tif (e.resourceType === 'mainFrame' && e.httpResponseCode >= 500) {\r\n\t\t\t\twebviewObj.loadURL(`file://${ __dirname }/loading-error.html`);\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\tthis.webviewParentElement.appendChild(webviewObj);\r\n\r\n\t\twebviewObj.src = host.lastPath || host.url;\r\n\t}\r\n\r\n\tremove(hostUrl) {\r\n\t\tconst el = this.getByUrl(hostUrl);\r\n\t\tif (el) {\r\n\t\t\tel.remove();\r\n\t\t}\r\n\t}\r\n\r\n\tsaveLastPath(hostUrl, lastPathUrl) {\r\n\t\tconst { hosts } = servers;\r\n\t\thosts[hostUrl].lastPath = lastPathUrl;\r\n\t\tservers.hosts = hosts;\r\n\t}\r\n\r\n\tgetByUrl(hostUrl) {\r\n\t\treturn this.webviewParentElement.querySelector(`webview[server=\"${ hostUrl }\"]`);\r\n\t}\r\n\r\n\tgetActive() {\r\n\t\treturn document.querySelector('webview.active');\r\n\t}\r\n\r\n\tisActive(hostUrl) {\r\n\t\treturn !!this.webviewParentElement.querySelector(`webview.active[server=\"${ hostUrl }\"]`);\r\n\t}\r\n\r\n\tdeactiveAll() {\r\n\t\tlet item;\r\n\t\twhile (!(item = this.getActive()) === false) {\r\n\t\t\titem.classList.remove('active');\r\n\t\t}\r\n\t\tdocument.querySelector('.landing-page').classList.add('hide');\r\n\t}\r\n\r\n\tshowLanding() {\r\n\t\tthis.loaded();\r\n\t\tdocument.querySelector('.landing-page').classList.remove('hide');\r\n\t}\r\n\r\n\tsetActive(hostUrl) {\r\n\t\tif (this.isActive(hostUrl)) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tthis.deactiveAll();\r\n\t\tconst item = this.getByUrl(hostUrl);\r\n\t\tif (item) {\r\n\t\t\titem.classList.add('active');\r\n\t\t}\r\n\t\tthis.focusActive();\r\n\t}\r\n\r\n\tfocusActive() {\r\n\t\tconst active = this.getActive();\r\n\t\tif (active) {\r\n\t\t\tactive.focus();\r\n\t\t\treturn true;\r\n\t\t}\r\n\t\treturn false;\r\n\t}\r\n\r\n\tgoBack() {\r\n\t\tthis.getActive().goBack();\r\n\t}\r\n\r\n\tgoForward() {\r\n\t\tthis.getActive().goForward();\r\n\t}\r\n}\r\n\r\nexport default new WebView();\r\n","import { EventEmitter } from 'events';\r\nimport { remote } from 'electron';\r\nimport i18n from '../i18n/index.js';\r\nimport servers from './servers';\r\nimport webview from './webview';\r\n\r\nclass SideBar extends EventEmitter {\r\n\tconstructor() {\r\n\t\tsuper();\r\n\r\n\t\tthis.sortOrder = JSON.parse(localStorage.getItem(this.sortOrderKey)) || [];\r\n\t\tlocalStorage.setItem(this.sortOrderKey, JSON.stringify(this.sortOrder));\r\n\r\n\t\tthis.listElement = document.getElementById('sidebar__servers');\r\n\r\n\t\tObject.values(servers.hosts)\r\n\t\t\t.sort((a, b) => this.sortOrder.indexOf(a.url) - this.sortOrder.indexOf(b.url))\r\n\t\t\t.forEach((host) => {\r\n\t\t\t\tthis.add(host);\r\n\t\t\t});\r\n\r\n\t\tservers.on('host-added', (hostUrl) => {\r\n\t\t\tthis.add(servers.get(hostUrl));\r\n\t\t});\r\n\r\n\t\tservers.on('host-removed', (hostUrl) => {\r\n\t\t\tthis.remove(hostUrl);\r\n\t\t});\r\n\r\n\t\tservers.on('active-setted', (hostUrl) => {\r\n\t\t\tthis.setActive(hostUrl);\r\n\t\t});\r\n\r\n\t\tservers.on('active-cleared', (hostUrl) => {\r\n\t\t\tthis.deactiveAll(hostUrl);\r\n\t\t});\r\n\r\n\t\tservers.on('title-setted', (hostUrl, title) => {\r\n\t\t\tthis.setLabel(hostUrl, title);\r\n\t\t});\r\n\r\n\t\twebview.on('dom-ready', (hostUrl) => {\r\n\t\t\tthis.setActive(localStorage.getItem(servers.activeKey));\r\n\t\t\twebview.getActive().send('request-sidebar-color');\r\n\t\t\tthis.setImage(hostUrl);\r\n\t\t\tif (this.isHidden()) {\r\n\t\t\t\tthis.hide();\r\n\t\t\t} else {\r\n\t\t\t\tthis.show();\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t}\r\n\r\n\tget sortOrderKey() {\r\n\t\treturn 'rocket.chat.sortOrder';\r\n\t}\r\n\r\n\tadd(host) {\r\n\t\tlet name = host.title.replace(/^https?:\\/\\/(?:www\\.)?([^\\/]+)(.*)/, '$1');\r\n\t\tname = name.split('.');\r\n\t\tname = name[0][0] + (name[1] ? name[1][0] : '');\r\n\t\tname = name.toUpperCase();\r\n\r\n\t\tconst initials = document.createElement('span');\r\n\t\tinitials.innerHTML = name;\r\n\r\n\t\tconst tooltip = document.createElement('div');\r\n\t\ttooltip.classList.add('tooltip');\r\n\t\ttooltip.innerHTML = host.title;\r\n\r\n\t\tconst badge = document.createElement('div');\r\n\t\tbadge.classList.add('badge');\r\n\r\n\t\tconst img = document.createElement('img');\r\n\t\timg.onload = function() {\r\n\t\t\timg.style.display = 'initial';\r\n\t\t\tinitials.style.display = 'none';\r\n\t\t};\r\n\r\n\t\tlet hostOrder = 0;\r\n\t\tif (this.sortOrder.includes(host.url)) {\r\n\t\t\thostOrder = this.sortOrder.indexOf(host.url) + 1;\r\n\t\t} else {\r\n\t\t\thostOrder = this.sortOrder.length + 1;\r\n\t\t\tthis.sortOrder.push(host.url);\r\n\t\t}\r\n\r\n\t\tconst hotkey = document.createElement('div');\r\n\t\thotkey.classList.add('name');\r\n\t\tif (process.platform === 'darwin') {\r\n\t\t\thotkey.innerHTML = `⌘${ hostOrder }`;\r\n\t\t} else {\r\n\t\t\thotkey.innerHTML = `^${ hostOrder }`;\r\n\t\t}\r\n\r\n\t\tconst item = document.createElement('li');\r\n\t\titem.appendChild(initials);\r\n\t\titem.appendChild(tooltip);\r\n\t\titem.appendChild(badge);\r\n\t\titem.appendChild(img);\r\n\t\titem.appendChild(hotkey);\r\n\r\n\t\titem.dataset.host = host.url;\r\n\t\titem.dataset.sortOrder = hostOrder;\r\n\t\titem.setAttribute('server', host.url);\r\n\t\titem.classList.add('instance');\r\n\r\n\t\titem.setAttribute('draggable', true);\r\n\r\n\t\titem.ondragstart = (event) => {\r\n\t\t\twindow.dragged = event.target.nodeName !== 'LI' ? event.target.closest('li') : event.target;\r\n\t\t\tevent.dataTransfer.effectAllowed = 'move';\r\n\t\t\tevent.dataTransfer.dropEffect = 'move';\r\n\t\t\tevent.target.style.opacity = .5;\r\n\t\t};\r\n\r\n\t\titem.ondragover = (event) => {\r\n\t\t\tevent.preventDefault();\r\n\t\t};\r\n\r\n\t\titem.ondragenter = (event) => {\r\n\t\t\tif (this.isBefore(window.dragged, event.target)) {\r\n\t\t\t\tevent.currentTarget.parentNode.insertBefore(window.dragged, event.currentTarget);\r\n\t\t\t} else if (event.currentTarget !== event.currentTarget.parentNode.lastChild) {\r\n\t\t\t\tevent.currentTarget.parentNode.insertBefore(window.dragged, event.currentTarget.nextSibling);\r\n\t\t\t} else {\r\n\t\t\t\tevent.currentTarget.parentNode.appendChild(window.dragged);\r\n\t\t\t}\r\n\t\t};\r\n\r\n\t\titem.ondragend = (event) => {\r\n\t\t\tevent.target.style.opacity = '';\r\n\t\t};\r\n\r\n\t\titem.ondrop = (event) => {\r\n\t\t\tevent.preventDefault();\r\n\r\n\t\t\tconst newSortOrder = [];\r\n\t\t\tArray.from(event.currentTarget.parentNode.children)\r\n\t\t\t\t.map((sideBarElement) => {\r\n\t\t\t\t\tconst url = sideBarElement.dataset.host;\r\n\t\t\t\t\tnewSortOrder.push(url);\r\n\t\t\t\t\tthis.remove(url);\r\n\r\n\t\t\t\t\treturn sideBarElement;\r\n\t\t\t\t})\r\n\t\t\t\t.forEach((sideBarElement) => {\r\n\t\t\t\t\tthis.sortOrder = newSortOrder;\r\n\t\t\t\t\tlocalStorage.setItem(this.sortOrderKey, JSON.stringify(this.sortOrder));\r\n\r\n\t\t\t\t\tconst url = sideBarElement.dataset.host;\r\n\t\t\t\t\tconst host = { url, title: sideBarElement.querySelector('div.tooltip').innerHTML };\r\n\t\t\t\t\tthis.add(host);\r\n\t\t\t\t\tthis.setImage(url);\r\n\t\t\t\t});\r\n\r\n\t\t\tthis.setActive(window.dragged.dataset.host);\r\n\t\t};\r\n\r\n\t\titem.onclick = () => {\r\n\t\t\tservers.setActive(host.url);\r\n\t\t};\r\n\r\n\t\tthis.listElement.appendChild(item);\r\n\t\tthis.emit('hosts-sorted');\r\n\t}\r\n\r\n\tsetImage(hostUrl) {\r\n\t\tconst img = this.getByUrl(hostUrl).querySelector('img');\r\n\t\timg.src = `${ hostUrl.replace(/\\/$/, '') }/assets/favicon.svg?v=${ Math.round(Math.random() * 10000) }`;\r\n\t}\r\n\r\n\tremove(hostUrl) {\r\n\t\tconst el = this.getByUrl(hostUrl);\r\n\t\tif (el) {\r\n\t\t\tel.remove();\r\n\t\t}\r\n\t}\r\n\r\n\tgetByUrl(hostUrl) {\r\n\t\treturn this.listElement.querySelector(`.instance[server=\"${ hostUrl }\"]`);\r\n\t}\r\n\r\n\tgetActive() {\r\n\t\treturn this.listElement.querySelector('.instance.active');\r\n\t}\r\n\r\n\tisActive(hostUrl) {\r\n\t\treturn !!this.listElement.querySelector(`.instance.active[server=\"${ hostUrl }\"]`);\r\n\t}\r\n\r\n\tchangeSidebarColor({ color, background }) {\r\n\t\tconst sidebar = document.querySelector('.sidebar');\r\n\t\tif (sidebar) {\r\n\t\t\tsidebar.style.background = background;\r\n\t\t\tsidebar.style.color = color;\r\n\t\t}\r\n\t}\r\n\r\n\tsetActive(hostUrl) {\r\n\t\tif (this.isActive(hostUrl)) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tthis.deactiveAll();\r\n\t\tconst item = this.getByUrl(hostUrl);\r\n\t\tif (item) {\r\n\t\t\titem.classList.add('active');\r\n\t\t}\r\n\t\tif (webview.getActive() && webview.getActive().classList.contains('ready')) {\r\n\t\t\twebview.getActive().send('request-sidebar-color');\r\n\t\t}\r\n\t}\r\n\r\n\tdeactiveAll() {\r\n\t\tlet item;\r\n\t\twhile (!(item = this.getActive()) === false) {\r\n\t\t\titem.classList.remove('active');\r\n\t\t}\r\n\t}\r\n\r\n\tsetLabel(hostUrl, label) {\r\n\t\tthis.listElement.querySelector(`.instance[server=\"${ hostUrl }\"] .tooltip`).innerHTML = label;\r\n\t}\r\n\r\n\tsetBadge(hostUrl, badge) {\r\n\t\tconst item = this.getByUrl(hostUrl);\r\n\t\tconst badgeEl = item.querySelector('.badge');\r\n\r\n\t\tif (badge !== null && badge !== undefined && badge !== '') {\r\n\t\t\titem.classList.add('unread');\r\n\t\t\tif (isNaN(parseInt(badge))) {\r\n\t\t\t\tbadgeEl.innerHTML = '';\r\n\t\t\t} else {\r\n\t\t\t\tbadgeEl.innerHTML = badge;\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tbadge = undefined;\r\n\t\t\titem.classList.remove('unread');\r\n\t\t\tbadgeEl.innerHTML = '';\r\n\t\t}\r\n\t\tthis.emit('badge-setted', hostUrl, badge);\r\n\t}\r\n\r\n\tgetGlobalBadge() {\r\n\t\tlet count = 0;\r\n\t\tlet title = '';\r\n\t\tconst instanceEls = this.listElement.querySelectorAll('li.instance');\r\n\t\tfor (let i = instanceEls.length - 1; i >= 0; i--) {\r\n\t\t\tconst instanceEl = instanceEls[i];\r\n\t\t\tconst text = instanceEl.querySelector('.badge').innerHTML;\r\n\t\t\tif (!isNaN(parseInt(text))) {\r\n\t\t\t\tcount += parseInt(text);\r\n\t\t\t}\r\n\t\t\tif (title === '' && instanceEl.classList.contains('unread') === true) {\r\n\t\t\t\ttitle = '•';\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (count > 0) {\r\n\t\t\ttitle = count.toString();\r\n\t\t}\r\n\t\treturn {\r\n\t\t\tcount,\r\n\t\t\ttitle,\r\n\t\t\tshowAlert: (title !== ''),\r\n\t\t};\r\n\t}\r\n\r\n\thide() {\r\n\t\tdocument.querySelector('.sidebar').classList.add('sidebar--hidden');\r\n\t\tlocalStorage.setItem('sidebar-closed', 'true');\r\n\t\tthis.emit('hide');\r\n\t\tif (process.platform === 'darwin') {\r\n\t\t\tdocument.querySelectorAll('webview').forEach(\r\n\t\t\t\t(webviewObj) => { if (webviewObj.insertCSS) { webviewObj.insertCSS('aside.side-nav{margin-top:15px;overflow:hidden; transition: margin .5s ease-in-out; } .sidebar{padding-top:10px;transition: margin .5s ease-in-out;}'); } });\r\n\t\t}\r\n\t}\r\n\r\n\tshow() {\r\n\t\tdocument.querySelector('.sidebar').classList.remove('sidebar--hidden');\r\n\t\tlocalStorage.setItem('sidebar-closed', 'false');\r\n\t\tthis.emit('show');\r\n\t\tif (process.platform === 'darwin') {\r\n\t\t\tdocument.querySelectorAll('webview').forEach(\r\n\t\t\t\t(webviewObj) => { if (webviewObj.insertCSS) { webviewObj.insertCSS('aside.side-nav{margin-top:0; overflow:hidden; transition: margin .5s ease-in-out;} .sidebar{padding-top:0;transition: margin .5s ease-in-out;}'); } });\r\n\t\t}\r\n\t}\r\n\r\n\ttoggle() {\r\n\t\tif (this.isHidden()) {\r\n\t\t\tthis.show();\r\n\t\t} else {\r\n\t\t\tthis.hide();\r\n\t\t}\r\n\t}\r\n\r\n\tisHidden() {\r\n\t\treturn localStorage.getItem('sidebar-closed') === 'true';\r\n\t}\r\n\r\n\tisBefore(a, b) {\r\n\t\tif (a.parentNode === b.parentNode) {\r\n\t\t\tfor (let cur = a; cur; cur = cur.previousSibling) {\r\n\t\t\t\tif (cur === b) {\r\n\t\t\t\t\treturn true;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn false;\r\n\t}\r\n}\r\n\r\nexport default new SideBar();\r\n\r\n\r\nlet selectedInstance = null;\r\nconst instanceMenu = remote.Menu.buildFromTemplate([{\r\n\tlabel: i18n.__('Reload_server'),\r\n\tclick() {\r\n\t\twebview.getByUrl(selectedInstance.dataset.host).reload();\r\n\t},\r\n}, {\r\n\tlabel: i18n.__('Remove_server'),\r\n\tclick() {\r\n\t\tservers.removeHost(selectedInstance.dataset.host);\r\n\t},\r\n}, {\r\n\tlabel: i18n.__('Open DevTools'),\r\n\tclick() {\r\n\t\twebview.getByUrl(selectedInstance.dataset.host).openDevTools();\r\n\t},\r\n}]);\r\n\r\nwindow.addEventListener('contextmenu', function(e) {\r\n\tif (e.target.classList.contains('instance') || e.target.parentNode.classList.contains('instance')) {\r\n\t\te.preventDefault();\r\n\t\tif (e.target.classList.contains('instance')) {\r\n\t\t\tselectedInstance = e.target;\r\n\t\t} else {\r\n\t\t\tselectedInstance = e.target.parentNode;\r\n\t\t}\r\n\r\n\t\tinstanceMenu.popup(remote.getCurrentWindow());\r\n\t}\r\n}, false);\r\n\r\nif (process.platform === 'darwin') {\r\n\twindow.addEventListener('keydown', function(e) {\r\n\t\tif (e.key === 'Meta') {\r\n\t\t\tdocument.getElementsByClassName('sidebar')[0].classList.add('command-pressed');\r\n\t\t}\r\n\t});\r\n\r\n\twindow.addEventListener('keyup', function(e) {\r\n\t\tif (e.key === 'Meta') {\r\n\t\t\tdocument.getElementsByClassName('sidebar')[0].classList.remove('command-pressed');\r\n\t\t}\r\n\t});\r\n} else {\r\n\twindow.addEventListener('keydown', function(e) {\r\n\t\tif (e.key === 'ctrlKey') {\r\n\t\t\tdocument.getElementsByClassName('sidebar')[0].classList.add('command-pressed');\r\n\t\t}\r\n\t});\r\n\r\n\twindow.addEventListener('keyup', function(e) {\r\n\t\tif (e.key === 'ctrlKey') {\r\n\t\t\tdocument.getElementsByClassName('sidebar')[0].classList.remove('command-pressed');\r\n\t\t}\r\n\t});\r\n}\r\n","import { remote } from 'electron';\r\nimport servers from './servers';\r\nimport webview from './webview';\r\nimport i18n from '../i18n/index.js';\r\n\r\nconst { TouchBar, nativeImage, getCurrentWindow } = remote;\r\nconst { TouchBarButton, TouchBarLabel, TouchBarSegmentedControl, TouchBarScrubber, TouchBarPopover, TouchBarGroup } = TouchBar;\r\n\r\nexport class SelectServerPanel {\r\n\tconstructor() {\r\n\t\tthis._MAX_LENGTH_FOR_SEGMENTS_CONTROL = 76 - i18n.__('Select_server').length;\r\n\t\tthis._hosts = [];\r\n\r\n\t\tthis._setHostsArray();\r\n\t\tthis._subscribe();\r\n\t}\r\n\r\n\t_isSegmentedControl() {\r\n\t\treturn this.control && this.control.hasOwnProperty('selectedIndex');\r\n\t}\r\n\r\n\t_getActiveServerIndex() {\r\n\t\treturn this._hosts.findIndex((value) => value.host === servers.active);\r\n\t}\r\n\r\n\t_setActiveServer() {\r\n\t\tif (this._isSegmentedControl()) {\r\n\t\t\tthis.control.selectedIndex = this._getActiveServerIndex();\r\n\t\t} else {\r\n\t\t\tthis._update();\r\n\t\t}\r\n\t}\r\n\r\n\t_setHostsArray() {\r\n\t\tthis._hosts = Object.values(servers.hosts).map((value) => ({ label: value.title, host: value.url }));\r\n\t\tthis._hosts = this._trimHostsNames(this._hosts);\r\n\t}\r\n\r\n\t_getTotalLengthOfHostsNames() {\r\n\t\treturn this._hosts.reduce((acc, host) => acc + host.label.length, 0);\r\n\t}\r\n\r\n\t_update() {\r\n\t\tthis._setHostsArray();\r\n\t\tif (this.control) {\r\n\t\t\tif (this._isSegmentedControl()) {\r\n\t\t\t\tthis.control.segments = this._hosts;\r\n\t\t\t} else {\r\n\t\t\t\tthis.control.items = this._hosts;\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tthis.build();\r\n\t\t}\r\n\t}\r\n\r\n\tbuild() {\r\n\t\tconst popoverItems = this._buildSelectServersPopoverItems();\r\n\r\n\t\tthis.touchBarPopover = new TouchBarPopover({\r\n\t\t\tlabel: i18n.__('Select_server'),\r\n\t\t\titems: new TouchBar({\r\n\t\t\t\titems: popoverItems,\r\n\t\t\t}),\r\n\t\t});\r\n\t\treturn this.touchBarPopover;\r\n\t}\r\n\r\n\t_buildSelectServersPopoverItems() {\r\n\t\tconst items = [\r\n\t\t\tnew TouchBarLabel({ label: i18n.__('Select_server') }),\r\n\t\t];\r\n\r\n\t\t// The maximum length of available display area is limited. If exceed the length of displayed data, then\r\n\t\t// touchbar element is not displayed. If the length of displayed host names exceeds the limit, then\r\n\t\t// the touchBarScrubber is used. In other case SegmentedControl is used.\r\n\t\tconst hostsNamesLength = this._getTotalLengthOfHostsNames();\r\n\r\n\t\tif (this._hosts.length) {\r\n\t\t\tif (hostsNamesLength <= this._MAX_LENGTH_FOR_SEGMENTS_CONTROL) {\r\n\t\t\t\titems.push(this._buildTouchBarSegmentedControl());\r\n\t\t\t} else {\r\n\t\t\t\titems.push(this._buildTouchBarScrubber());\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn items;\r\n\t}\r\n\r\n\t_buildTouchBarSegmentedControl() {\r\n\t\tthis.control = new TouchBarSegmentedControl({\r\n\t\t\tsegmentStyle: 'separated',\r\n\t\t\tselectedIndex: this._getActiveServerIndex(),\r\n\t\t\tsegments: this._hosts,\r\n\t\t\tchange: (index) => {\r\n\t\t\t\tservers.setActive(this._hosts[index].host);\r\n\t\t\t},\r\n\t\t});\r\n\t\treturn this.control;\r\n\t}\r\n\r\n\t_buildTouchBarScrubber() {\r\n\t\tthis.control = new TouchBarScrubber({\r\n\t\t\tselectedStyle: 'background',\r\n\t\t\tshowArrowButtons: true,\r\n\t\t\tmode: 'fixed',\r\n\t\t\titems: this._hosts,\r\n\t\t\thighlight: (index) => {\r\n\t\t\t\tservers.setActive(this._hosts[index].host);\r\n\t\t\t},\r\n\t\t});\r\n\t\treturn this.control;\r\n\t}\r\n\r\n\t_subscribe() {\r\n\t\tservers.on('active-setted', () => this._setActiveServer());\r\n\t\tservers.on('host-added', () => this._update());\r\n\t\tservers.on('host-removed', () => this._update());\r\n\t\tservers.on('title-setted', () => this._update());\r\n\t}\r\n\r\n\t/**\r\n\t * If it is possible to fit the hosts names to the specific limit, then trim the hosts names to the format \"open.rocke..\"\r\n\t * @param arr {Array} array of hosts\r\n\t * @returns {Array} array of hosts\r\n\t */\r\n\t_trimHostsNames(arr) {\r\n\t\tconst hostsNamesLength = this._getTotalLengthOfHostsNames();\r\n\r\n\t\tif (hostsNamesLength <= this._MAX_LENGTH_FOR_SEGMENTS_CONTROL) {\r\n\t\t\treturn arr;\r\n\t\t}\r\n\r\n\t\t// The total length of hosts names with reserved space for '..' characters\r\n\t\tconst amountOfCharsToDisplay = this._MAX_LENGTH_FOR_SEGMENTS_CONTROL - 2 * arr.length;\r\n\t\tconst amountOfCharsPerHost = Math.floor(amountOfCharsToDisplay / arr.length);\r\n\r\n\t\tif (amountOfCharsPerHost > 0) {\r\n\t\t\tlet additionChars = amountOfCharsToDisplay % arr.length;\r\n\t\t\treturn arr.map((host) => {\r\n\t\t\t\tif (amountOfCharsPerHost < host.label.length) {\r\n\t\t\t\t\tlet additionChar = 0;\r\n\t\t\t\t\tif (additionChars) {\r\n\t\t\t\t\t\tadditionChar = 1;\r\n\t\t\t\t\t\tadditionChars--;\r\n\t\t\t\t\t}\r\n\t\t\t\t\thost.label = `${ host.label.slice(0, amountOfCharsPerHost + additionChar) }..`;\r\n\t\t\t\t}\r\n\t\t\t\treturn host;\r\n\t\t\t});\r\n\t\t}\r\n\t\treturn arr;\r\n\t}\r\n}\r\n\r\nexport class FormattingPanel {\r\n\tconstructor() {\r\n\t\tthis._buttonClasses = ['bold', 'italic', 'strike', 'code', 'multi-line'];\r\n\t\tthis._BACKGROUND_COLOR = '#A4A4A4';\r\n\t}\r\n\r\n\tbuild() {\r\n\t\tconst formatButtons = [];\r\n\r\n\t\tthis._buttonClasses.forEach((buttonClass) => {\r\n\t\t\tconst touchBarButton = new TouchBarButton({\r\n\t\t\t\tbackgroundColor: this._BACKGROUND_COLOR,\r\n\t\t\t\ticon: nativeImage.createFromPath(`${ __dirname }/images/icon-${ buttonClass }.png`),\r\n\t\t\t\tclick: () => {\r\n\t\t\t\t\twebview.getActive().executeJavaScript(`\r\n\t\t\t\t\t\tvar svg = document.querySelector(\"button svg[class$='${ buttonClass }']\");\r\n\t\t\t\t\t\tsvg && svg.parentNode.click();\r\n\t\t\t\t\t\t`.trim());\r\n\t\t\t\t},\r\n\t\t\t});\r\n\t\t\tformatButtons.push(touchBarButton);\r\n\t\t});\r\n\r\n\t\tthis._touchBarGroup = new TouchBarGroup({\r\n\t\t\titems: [\r\n\t\t\t\tnew TouchBarLabel({ label: i18n.__('Formatting') }),\r\n\t\t\t\t...formatButtons,\r\n\t\t\t],\r\n\t\t});\r\n\t\treturn this._touchBarGroup;\r\n\t}\r\n}\r\n\r\nexport class TouchBarBuilder {\r\n\tconstructor() {\r\n\t\tthis._touchBarElements = {};\r\n\t}\r\n\r\n\tbuild() {\r\n\t\tthis._touchBar = new TouchBar({\r\n\t\t\titems: Object.values(this._touchBarElements).map((element) => element.build()),\r\n\t\t});\r\n\t\treturn this._touchBar;\r\n\t}\r\n\r\n\taddSelectServerPanel(panel) {\r\n\t\tif (this._isPanel(panel)) {\r\n\t\t\tthis._touchBarElements.selectServerPanel = panel;\r\n\t\t}\r\n\t\treturn this;\r\n\t}\r\n\r\n\taddFormattingPanel(panel) {\r\n\t\tif (this._isPanel(panel)) {\r\n\t\t\tthis._touchBarElements.formattingtPanel = panel;\r\n\t\t}\r\n\t\treturn this;\r\n\t}\r\n\r\n\t_isPanel(panel) {\r\n\t\treturn panel && typeof panel.build === 'function';\r\n\t}\r\n}\r\n\r\nexport default function setTouchBar() {\r\n\tservers.once('active-setted', () => {\r\n\t\tconst touchBar = new TouchBarBuilder()\r\n\t\t\t.addSelectServerPanel(new SelectServerPanel())\r\n\t\t\t.addFormattingPanel(new FormattingPanel())\r\n\t\t\t.build();\r\n\t\tgetCurrentWindow().setTouchBar(touchBar);\r\n\t});\r\n}\r\n","import { remote, ipcRenderer } from 'electron';\r\nimport servers from './servers';\r\nimport sidebar from './sidebar';\r\nimport webview from './webview';\r\nimport setTouchBar from './touchBar';\r\n\r\n\r\nconst { app, getCurrentWindow, shell } = remote;\r\nconst { certificate, dock, menus, tray } = remote.require('./background');\r\n\r\nconst updatePreferences = () => {\r\n\tconst mainWindow = getCurrentWindow();\r\n\r\n\tmenus.setState({\r\n\t\tshowTrayIcon: localStorage.getItem('hideTray') ?\r\n\t\t\tlocalStorage.getItem('hideTray') !== 'true' : (process.platform !== 'linux'),\r\n\t\tshowUserStatusInTray: (localStorage.getItem('showUserStatusInTray') || 'true') === 'true',\r\n\t\tshowFullScreen: mainWindow.isFullScreen(),\r\n\t\tshowWindowOnUnreadChanged: localStorage.getItem('showWindowOnUnreadChanged') === 'true',\r\n\t\tshowMenuBar: localStorage.getItem('autohideMenu') !== 'true',\r\n\t\tshowServerList: localStorage.getItem('sidebar-closed') !== 'true',\r\n\t});\r\n\r\n\ttray.setState({\r\n\t\tshowIcon: localStorage.getItem('hideTray') ?\r\n\t\t\tlocalStorage.getItem('hideTray') !== 'true' : (process.platform !== 'linux'),\r\n\t\tshowUserStatus: (localStorage.getItem('showUserStatusInTray') || 'true') === 'true',\r\n\t});\r\n};\r\n\r\n\r\nconst updateServers = () => {\r\n\tmenus.setState({\r\n\t\tservers: Object.values(servers.hosts)\r\n\t\t\t.sort((a, b) => (sidebar ? (sidebar.sortOrder.indexOf(a.url) - sidebar.sortOrder.indexOf(b.url)) : 0))\r\n\t\t\t.map(({ title, url }) => ({ title, url })),\r\n\t\tcurrentServerUrl: servers.active,\r\n\t});\r\n};\r\n\r\n\r\nconst updateWindowState = () => tray.setState({ isMainWindowVisible: getCurrentWindow().isVisible() });\r\n\r\nconst destroyAll = () => {\r\n\ttry {\r\n\t\tmenus.removeAllListeners();\r\n\t\ttray.destroy();\r\n\t\tdock.destroy();\r\n\t\tconst mainWindow = getCurrentWindow();\r\n\t\tmainWindow.removeListener('hide', updateWindowState);\r\n\t\tmainWindow.removeListener('show', updateWindowState);\r\n\t} catch (error) {\r\n\t\tremote.getGlobal('console').error(error);\r\n\t}\r\n};\r\n\r\nexport default () => {\r\n\twindow.addEventListener('beforeunload', destroyAll);\r\n\r\n\tmenus.on('quit', () => app.quit());\r\n\tmenus.on('about', () => ipcRenderer.send('open-about-dialog'));\r\n\tmenus.on('open-url', (url) => shell.openExternal(url));\r\n\r\n\tmenus.on('add-new-server', () => {\r\n\t\tgetCurrentWindow().show();\r\n\t\tservers.clearActive();\r\n\t\twebview.showLanding();\r\n\t});\r\n\r\n\tmenus.on('select-server', ({ url }) => {\r\n\t\tgetCurrentWindow().show();\r\n\t\tservers.setActive(url);\r\n\t});\r\n\r\n\tmenus.on('reload-server', ({ ignoringCache = false, clearCertificates = false } = {}) => {\r\n\t\tif (clearCertificates) {\r\n\t\t\tcertificate.clear();\r\n\t\t}\r\n\r\n\t\tconst activeWebview = webview.getActive();\r\n\t\tif (!activeWebview) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tif (ignoringCache) {\r\n\t\t\tactiveWebview.reloadIgnoringCache();\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tactiveWebview.reload();\r\n\t});\r\n\r\n\tmenus.on('open-devtools-for-server', () => {\r\n\t\tconst activeWebview = webview.getActive();\r\n\t\tif (activeWebview) {\r\n\t\t\tactiveWebview.openDevTools();\r\n\t\t}\r\n\t});\r\n\r\n\tmenus.on('go-back', () => webview.goBack());\r\n\tmenus.on('go-forward', () => webview.goForward());\r\n\r\n\tmenus.on('reload-app', () => getCurrentWindow().reload());\r\n\r\n\tmenus.on('toggle-devtools', () => getCurrentWindow().toggleDevTools());\r\n\r\n\tmenus.on('reset-app-data', () => servers.resetAppData());\r\n\r\n\tmenus.on('toggle', (property) => {\r\n\t\tswitch (property) {\r\n\t\t\tcase 'showTrayIcon': {\r\n\t\t\t\tconst previousValue = localStorage.getItem('hideTray') !== 'true';\r\n\t\t\t\tconst newValue = !previousValue;\r\n\t\t\t\tlocalStorage.setItem('hideTray', JSON.stringify(!newValue));\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\r\n\t\t\tcase 'showUserStatusInTray': {\r\n\t\t\t\tconst previousValue = (localStorage.getItem('showUserStatusInTray') || 'true') === 'true';\r\n\t\t\t\tconst newValue = !previousValue;\r\n\t\t\t\tlocalStorage.setItem('showUserStatusInTray', JSON.stringify(newValue));\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\r\n\t\t\tcase 'showFullScreen': {\r\n\t\t\t\tconst mainWindow = getCurrentWindow();\r\n\t\t\t\tmainWindow.setFullScreen(!mainWindow.isFullScreen());\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\r\n\t\t\tcase 'showWindowOnUnreadChanged': {\r\n\t\t\t\tconst previousValue = localStorage.getItem('showWindowOnUnreadChanged') === 'true';\r\n\t\t\t\tconst newValue = !previousValue;\r\n\t\t\t\tlocalStorage.setItem('showWindowOnUnreadChanged', JSON.stringify(newValue));\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\r\n\t\t\tcase 'showMenuBar': {\r\n\t\t\t\tconst previousValue = localStorage.getItem('autohideMenu') !== 'true';\r\n\t\t\t\tconst newValue = !previousValue;\r\n\t\t\t\tlocalStorage.setItem('autohideMenu', JSON.stringify(!newValue));\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\r\n\t\t\tcase 'showServerList': {\r\n\t\t\t\tsidebar.toggle();\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tupdatePreferences();\r\n\t});\r\n\r\n\tservers.on('loaded', updateServers);\r\n\tservers.on('active-cleared', updateServers);\r\n\tservers.on('active-setted', updateServers);\r\n\tservers.on('host-added', updateServers);\r\n\tservers.on('host-removed', updateServers);\r\n\tservers.on('title-setted', updateServers);\r\n\tsidebar.on('hosts-sorted', updateServers);\r\n\r\n\tsidebar.on('badge-setted', () => {\r\n\t\tconst badge = sidebar.getGlobalBadge();\r\n\t\ttray.setState({ badge });\r\n\t\tdock.setState({ badge });\r\n\t});\r\n\r\n\tgetCurrentWindow().on('hide', updateWindowState);\r\n\tgetCurrentWindow().on('show', updateWindowState);\r\n\r\n\ttray.on('created', () => getCurrentWindow().emit('set-state', { hideOnClose: true }));\r\n\ttray.on('destroyed', () => getCurrentWindow().emit('set-state', { hideOnClose: false }));\r\n\ttray.on('set-main-window-visibility', (visible) =>\r\n\t\t(visible ? getCurrentWindow().show() : getCurrentWindow().hide()));\r\n\ttray.on('quit', () => app.quit());\r\n\r\n\r\n\twebview.on('ipc-message-unread-changed', (hostUrl, [count]) => {\r\n\t\tif (typeof count === 'number' && localStorage.getItem('showWindowOnUnreadChanged') === 'true') {\r\n\t\t\tconst mainWindow = remote.getCurrentWindow();\r\n\t\t\tif (!mainWindow.isFocused()) {\r\n\t\t\t\tmainWindow.once('focus', () => mainWindow.flashFrame(false));\r\n\t\t\t\tmainWindow.showInactive();\r\n\t\t\t\tmainWindow.flashFrame(true);\r\n\t\t\t}\r\n\t\t}\r\n\t});\r\n\r\n\twebview.on('ipc-message-user-status-manually-set', (hostUrl, [status]) => {\r\n\t\ttray.setState({ status });\r\n\t\tdock.setState({ status });\r\n\t});\r\n\r\n\tif (process.platform === 'darwin') {\r\n\t\tsetTouchBar();\r\n\t}\r\n\r\n\r\n\tservers.restoreActive();\r\n\tupdatePreferences();\r\n\tupdateServers();\r\n\tupdateWindowState();\r\n\r\n};\r\n","import { ipcRenderer, shell } from 'electron';\r\nimport attachEvents from './events';\r\nimport servers from './servers';\r\nimport sidebar from './sidebar';\r\nimport webview from './webview';\r\nimport i18n from '../i18n/index.js';\r\n\r\nexport const start = function() {\r\n\tconst defaultInstance = 'https://open.rocket.chat';\r\n\r\n\t// connection check\r\n\tfunction online() {\r\n\t\tdocument.body.classList.remove('offline');\r\n\t}\r\n\r\n\tfunction offline() {\r\n\t\tdocument.body.classList.add('offline');\r\n\t}\r\n\r\n\tif (!navigator.onLine) {\r\n\t\toffline();\r\n\t}\r\n\r\n\twindow.addEventListener('online', online);\r\n\twindow.addEventListener('offline', offline);\r\n\t// end connection check\r\n\r\n\tconst form = document.querySelector('form');\r\n\tconst hostField = form.querySelector('[name=\"host\"]');\r\n\tconst button = form.querySelector('[type=\"submit\"]');\r\n\tconst invalidUrl = form.querySelector('#invalidUrl');\r\n\r\n\twindow.addEventListener('load', () => hostField.focus());\r\n\r\n\twindow.addEventListener('focus', () => webview.focusActive());\r\n\r\n\tfunction validateHost() {\r\n\t\treturn new Promise(function(resolve, reject) {\r\n\t\t\tconst execValidation = function() {\r\n\t\t\t\tinvalidUrl.style.display = 'none';\r\n\t\t\t\thostField.classList.remove('wrong');\r\n\r\n\t\t\t\tconst host = hostField.value.trim();\r\n\t\t\t\thostField.value = host;\r\n\r\n\t\t\t\tif (host.length === 0) {\r\n\t\t\t\t\tbutton.value = i18n.__('Connect');\r\n\t\t\t\t\tbutton.disabled = false;\r\n\t\t\t\t\tresolve();\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tbutton.value = i18n.__('Validating');\r\n\t\t\t\tbutton.disabled = true;\r\n\r\n\t\t\t\tservers.validateHost(host, 2000).then(function() {\r\n\t\t\t\t\tbutton.value = i18n.__('Connect');\r\n\t\t\t\t\tbutton.disabled = false;\r\n\t\t\t\t\tresolve();\r\n\t\t\t\t}, function(status) {\r\n\t\t\t\t\t// If the url begins with HTTP, mark as invalid\r\n\t\t\t\t\tif (/^https?:\\/\\/.+/.test(host) || status === 'basic-auth') {\r\n\t\t\t\t\t\tbutton.value = i18n.__('Invalid_url');\r\n\t\t\t\t\t\tinvalidUrl.style.display = 'block';\r\n\t\t\t\t\t\tswitch (status) {\r\n\t\t\t\t\t\t\tcase 'basic-auth':\r\n\t\t\t\t\t\t\t\tinvalidUrl.innerHTML = i18n.__('Auth_needed_try', '<b>username:password@host</b>');\r\n\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\tcase 'invalid':\r\n\t\t\t\t\t\t\t\tinvalidUrl.innerHTML = i18n.__('No_valid_server_found');\r\n\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\tcase 'timeout':\r\n\t\t\t\t\t\t\t\tinvalidUrl.innerHTML = i18n.__('Timeout_trying_to_connect');\r\n\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\thostField.classList.add('wrong');\r\n\t\t\t\t\t\treject();\r\n\t\t\t\t\t\treturn;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t// // If the url begins with HTTPS, fallback to HTTP\r\n\t\t\t\t\t// if (/^https:\\/\\/.+/.test(host)) {\r\n\t\t\t\t\t//     hostField.value = host.replace('https://', 'http://');\r\n\t\t\t\t\t//     return execValidation();\r\n\t\t\t\t\t// }\r\n\r\n\t\t\t\t\t// If the url isn't localhost, don't have dots and don't have protocol\r\n\t\t\t\t\t// try as a .rocket.chat subdomain\r\n\t\t\t\t\tif (!/(^https?:\\/\\/)|(\\.)|(^([^:]+:[^@]+@)?localhost(:\\d+)?$)/.test(host)) {\r\n\t\t\t\t\t\thostField.value = `https://${ host }.rocket.chat`;\r\n\t\t\t\t\t\treturn execValidation();\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t// If the url don't start with protocol try HTTPS\r\n\t\t\t\t\tif (!/^https?:\\/\\//.test(host)) {\r\n\t\t\t\t\t\thostField.value = `https://${ host }`;\r\n\t\t\t\t\t\treturn execValidation();\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t};\r\n\t\t\texecValidation();\r\n\t\t});\r\n\t}\r\n\r\n\thostField.addEventListener('blur', function() {\r\n\t\tvalidateHost().then(function() {}, function() {});\r\n\t});\r\n\r\n\tipcRenderer.on('certificate-reload', function(event, url) {\r\n\t\thostField.value = url.replace(/\\/api\\/info$/, '');\r\n\t\tvalidateHost().then(function() {}, function() {});\r\n\t});\r\n\r\n\tconst submit = function() {\r\n\t\tvalidateHost().then(function() {\r\n\t\t\tconst input = form.querySelector('[name=\"host\"]');\r\n\t\t\tlet url = input.value;\r\n\r\n\t\t\tif (url.length === 0) {\r\n\t\t\t\turl = defaultInstance;\r\n\t\t\t}\r\n\r\n\t\t\turl = servers.addHost(url);\r\n\t\t\tif (url !== false) {\r\n\t\t\t\tsidebar.show();\r\n\t\t\t\tservers.setActive(url);\r\n\t\t\t}\r\n\r\n\t\t\tinput.value = '';\r\n\t\t}, function() {});\r\n\t};\r\n\r\n\thostField.addEventListener('keydown', function(ev) {\r\n\t\tif (ev.which === 13) {\r\n\t\t\tev.preventDefault();\r\n\t\t\tev.stopPropagation();\r\n\t\t\tsubmit();\r\n\t\t\treturn false;\r\n\t\t}\r\n\t});\r\n\r\n\tform.addEventListener('submit', function(ev) {\r\n\t\tev.preventDefault();\r\n\t\tev.stopPropagation();\r\n\t\tsubmit();\r\n\t\treturn false;\r\n\t});\r\n\r\n\tdocument.querySelector('.add-server').addEventListener('click', () => {\r\n\t\tservers.clearActive();\r\n\t\twebview.showLanding();\r\n\t});\r\n\r\n\tdocument.addEventListener('click', (event) => {\r\n\t\tconst anchorElement = event.target.closest('a[rel=\"noopener noreferrer\"]');\r\n\t\tif (anchorElement) {\r\n\t\t\tshell.openExternal(anchorElement.href);\r\n\t\t\tevent.preventDefault();\r\n\t\t}\r\n\t});\r\n\r\n\tattachEvents();\r\n};\r\n","import { start } from './scripts/start';\r\n\r\nstart();\r\n"],"names":["app","remote","EventEmitter","ipcRenderer","path","getCurrentWindow","shell"],"mappings":"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"}